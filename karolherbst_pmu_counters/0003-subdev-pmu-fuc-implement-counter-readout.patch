From eb9d5080af3f3e3daae3432a37616025386da81a Mon Sep 17 00:00:00 2001
From: Karol Herbst <nouveau@karolherbst.de>
Date: Fri, 9 Oct 2015 22:52:54 +0200
Subject: [PATCH 3/4] subdev/pmu/fuc: implement counter readout

v2: read counters out faster

Signed-off-by: Karol Herbst <nouveau@karolherbst.de>
---
 drm/nouveau/nvkm/subdev/pmu/fuc/gf100.fuc3.h | 785 +++++++++++++++------------
 drm/nouveau/nvkm/subdev/pmu/fuc/gf119.fuc4.h | 757 ++++++++++++++------------
 drm/nouveau/nvkm/subdev/pmu/fuc/gk104.fuc4.h | 757 ++++++++++++++------------
 drm/nouveau/nvkm/subdev/pmu/fuc/gk208.fuc5.h | 335 +++++++-----
 drm/nouveau/nvkm/subdev/pmu/fuc/gt215.fuc3.h | 730 +++++++++++++++----------
 drm/nouveau/nvkm/subdev/pmu/fuc/os.h         |  14 +
 drm/nouveau/nvkm/subdev/pmu/fuc/perf.fuc     | 162 ++++++
 7 files changed, 2072 insertions(+), 1468 deletions(-)

diff --git a/drm/nouveau/nvkm/subdev/pmu/fuc/gf100.fuc3.h b/drm/nouveau/nvkm/subdev/pmu/fuc/gf100.fuc3.h
index e2faccf..2d63a8d 100644
--- a/drm/nouveau/nvkm/subdev/pmu/fuc/gf100.fuc3.h
+++ b/drm/nouveau/nvkm/subdev/pmu/fuc/gf100.fuc3.h
@@ -68,7 +68,7 @@ uint32_t gf100_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x46524550,
-	0x0000075a,
+	0x00000895,
 	0x00000758,
 	0x00000000,
 	0x00000000,
@@ -90,8 +90,8 @@ uint32_t gf100_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x5f433249,
-	0x00000b8a,
-	0x00000a2d,
+	0x00000d74,
+	0x00000c17,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -112,8 +112,8 @@ uint32_t gf100_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x54534554,
-	0x00000bb3,
-	0x00000b8c,
+	0x00000d9d,
+	0x00000d76,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -134,8 +134,8 @@ uint32_t gf100_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x454c4449,
-	0x00000bbf,
-	0x00000bbd,
+	0x00000da9,
+	0x00000da7,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -834,7 +834,15 @@ uint32_t gf100_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 /* 0x0ccc: memx_train_tail */
-/* 0x0ccc: i2c_scl_map */
+/* 0x0ccc: perf_attr_start */
+/* 0x0ccc: perf_polling_period_us */
+	0x000186a0,
+/* 0x0cd0: perf_eng_gr */
+/* 0x0cd1: perf_eng_vid */
+/* 0x0cd2: perf_eng_mc */
+/* 0x0cd3: perf_eng_pcie */
+	0x00000000,
+/* 0x0cd4: i2c_scl_map */
 	0x00001000,
 	0x00004000,
 	0x00010000,
@@ -845,7 +853,7 @@ uint32_t gf100_pmu_data[] = {
 	0x01000000,
 	0x04000000,
 	0x10000000,
-/* 0x0cf4: i2c_sda_map */
+/* 0x0cfc: i2c_sda_map */
 	0x00002000,
 	0x00008000,
 	0x00020000,
@@ -856,7 +864,7 @@ uint32_t gf100_pmu_data[] = {
 	0x02000000,
 	0x08000000,
 	0x20000000,
-/* 0x0d1c: i2c_ctrl */
+/* 0x0d24: i2c_ctrl */
 	0x0000e138,
 	0x0000e150,
 	0x0000e168,
@@ -912,8 +920,6 @@ uint32_t gf100_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x00000000,
-	0x00000000,
-	0x00000000,
 };
 
 uint32_t gf100_pmu_code[] = {
@@ -1452,411 +1458,478 @@ uint32_t gf100_pmu_code[] = {
 /* 0x0756: memx_init */
 	0x00f800f8,
 /* 0x0758: perf_recv */
-/* 0x075a: perf_init */
-	0x00f800f8,
-/* 0x075c: i2c_drive_scl */
-	0xf40036b0,
-	0x07f1110b,
-	0x04b607e0,
-	0x0001d006,
-	0x00f804bd,
-/* 0x0770: i2c_drive_scl_lo */
-	0x07e407f1,
+	0x4f48a7f1,
+	0x5453a3f1,
+	0xf406eab8,
+	0xd6b04d1b,
+	0x5f1bf401,
+	0xc4bdb4bd,
+	0x0cd307f1,
+	0x180003f0,
+	0x04bd000c,
+	0xf108c4b6,
+	0xf00cd207,
+	0x0c180003,
+	0xb604bd00,
+	0x07f108c4,
+	0x03f00cd1,
+	0x000c1800,
+	0xc4b604bd,
+	0xd007f108,
+	0x0003f00c,
+	0xbd000c18,
+	0x3621f504,
+	0x1b0ef403,
+/* 0x07b0: perf_recv_not_host */
+	0x07ca21f5,
+	0x0ccc07f1,
+	0x980003f0,
+	0x04bd000e,
+	0x022a21f5,
+	0x025621f5,
+/* 0x07c8: perf_recv_exit */
+/* 0x07ca: perf_counter_readout */
+	0x10f900f8,
+	0x30f920f9,
+	0x50f940f9,
+	0x050817f1,
+	0xcf0614b6,
+	0x27f10011,
+	0x24b60518,
+	0x0022cf06,
+	0x052837f1,
+	0xcf0634b6,
+	0x47f10033,
+	0x44b60538,
+	0x0044cf06,
+	0x054857f1,
+	0xcf0654b6,
+	0xe7f10055,
+	0xe3f10000,
+	0x07f18000,
+	0x04b60508,
+	0x000ed006,
+	0x07f104bd,
+	0x04b60518,
+	0x000ed006,
+	0x07f104bd,
+	0x04b60528,
+	0x000ed006,
+	0x07f104bd,
+	0x04b60538,
+	0x000ed006,
+	0x07f104bd,
+	0x04b60548,
+	0x000ed006,
+	0x11cc04bd,
+	0x2c21ffff,
+	0x0cd007f1,
+	0x000003f0,
+	0x04bd0002,
+	0xf13c31ff,
+	0xf00cd107,
+	0x03000003,
+	0xff04bd00,
+	0x07f14c41,
+	0x03f00cd2,
+	0x00040000,
+	0x51ff04bd,
+	0xd307f15c,
+	0x0003f00c,
+	0xbd000500,
+	0xfc50fc04,
+	0xfc30fc40,
+	0xf810fc20,
+/* 0x0895: perf_init */
+	0x03e7f100,
+	0x00e3f000,
+	0x050c07f1,
 	0xd00604b6,
-	0x04bd0001,
-/* 0x077e: i2c_drive_sda */
+	0x04bd000e,
+	0x0002e7f1,
+	0xf100e3f0,
+	0xb6051c07,
+	0x0ed00604,
+	0xf104bd00,
+	0xb6052c07,
+	0x0ed00604,
+	0xf104bd00,
+	0xb6053c07,
+	0x0ed00604,
+	0xf104bd00,
+	0xb6054c07,
+	0x0ed00604,
+	0xf104bd00,
+	0xf0000fe7,
+	0x07f118e3,
+	0x04b60514,
+	0x000ed006,
+	0xe7f104bd,
+	0xe3f00070,
+	0x2407f100,
+	0x0604b605,
+	0xbd000ed0,
+	0x80e7f104,
+	0x00e3f000,
+	0x053407f1,
+	0xd00604b6,
+	0x04bd000e,
+	0x0000e7f1,
+	0x2000e3f1,
+	0x054407f1,
+	0xd00604b6,
+	0x04bd000e,
+	0x07ca21f5,
+	0x0ccc07f1,
+	0x980003f0,
+	0x04bd000e,
+	0x022a21f5,
+	0x025621f5,
+/* 0x0946: i2c_drive_scl */
 	0x36b000f8,
 	0x110bf400,
 	0x07e007f1,
 	0xd00604b6,
-	0x04bd0002,
-/* 0x0792: i2c_drive_sda_lo */
+	0x04bd0001,
+/* 0x095a: i2c_drive_scl_lo */
 	0x07f100f8,
 	0x04b607e4,
+	0x0001d006,
+	0x00f804bd,
+/* 0x0968: i2c_drive_sda */
+	0xf40036b0,
+	0x07f1110b,
+	0x04b607e0,
 	0x0002d006,
 	0x00f804bd,
-/* 0x07a0: i2c_sense_scl */
-	0xf10132f4,
-	0xb607c437,
-	0x33cf0634,
-	0x0431fd00,
-	0xf4060bf4,
-/* 0x07b6: i2c_sense_scl_done */
-	0x00f80131,
-/* 0x07b8: i2c_sense_sda */
-	0xf10132f4,
-	0xb607c437,
-	0x33cf0634,
-	0x0432fd00,
-	0xf4060bf4,
-/* 0x07ce: i2c_sense_sda_done */
-	0x00f80131,
-/* 0x07d0: i2c_raise_scl */
-	0x47f140f9,
-	0x37f00898,
-	0x5c21f501,
-/* 0x07dd: i2c_raise_scl_wait */
-	0xe8e7f107,
-	0x7e21f403,
-	0x07a021f5,
-	0xb60901f4,
-	0x1bf40142,
-/* 0x07f1: i2c_raise_scl_done */
-	0xf840fcef,
-/* 0x07f5: i2c_start */
-	0xa021f500,
-	0x0d11f407,
-	0x07b821f5,
-	0xf40611f4,
-/* 0x0806: i2c_start_rep */
-	0x37f0300e,
-	0x5c21f500,
-	0x0137f007,
-	0x077e21f5,
-	0xb60076bb,
-	0x50f90465,
-	0xbb046594,
-	0x50bd0256,
-	0xfc0475fd,
-	0xd021f550,
-	0x0464b607,
-/* 0x0833: i2c_start_send */
-	0xf01f11f4,
+/* 0x097c: i2c_drive_sda_lo */
+	0x07e407f1,
+	0xd00604b6,
+	0x04bd0002,
+/* 0x098a: i2c_sense_scl */
+	0x32f400f8,
+	0xc437f101,
+	0x0634b607,
+	0xfd0033cf,
+	0x0bf40431,
+	0x0131f406,
+/* 0x09a0: i2c_sense_scl_done */
+/* 0x09a2: i2c_sense_sda */
+	0x32f400f8,
+	0xc437f101,
+	0x0634b607,
+	0xfd0033cf,
+	0x0bf40432,
+	0x0131f406,
+/* 0x09b8: i2c_sense_sda_done */
+/* 0x09ba: i2c_raise_scl */
+	0x40f900f8,
+	0x089847f1,
+	0xf50137f0,
+/* 0x09c7: i2c_raise_scl_wait */
+	0xf1094621,
+	0xf403e8e7,
+	0x21f57e21,
+	0x01f4098a,
+	0x0142b609,
+/* 0x09db: i2c_raise_scl_done */
+	0xfcef1bf4,
+/* 0x09df: i2c_start */
+	0xf500f840,
+	0xf4098a21,
+	0x21f50d11,
+	0x11f409a2,
+	0x300ef406,
+/* 0x09f0: i2c_start_rep */
+	0xf50037f0,
+	0xf0094621,
+	0x21f50137,
+	0x76bb0968,
+	0x0465b600,
+	0x659450f9,
+	0x0256bb04,
+	0x75fd50bd,
+	0xf550fc04,
+	0xb609ba21,
+	0x11f40464,
+/* 0x0a1d: i2c_start_send */
+	0x0037f01f,
+	0x096821f5,
+	0x1388e7f1,
+	0xf07e21f4,
 	0x21f50037,
-	0xe7f1077e,
+	0xe7f10946,
 	0x21f41388,
-	0x0037f07e,
-	0x075c21f5,
-	0x1388e7f1,
-/* 0x084f: i2c_start_out */
-	0xf87e21f4,
-/* 0x0851: i2c_stop */
-	0x0037f000,
-	0x075c21f5,
-	0xf50037f0,
-	0xf1077e21,
-	0xf403e8e7,
-	0x37f07e21,
-	0x5c21f501,
-	0x88e7f107,
-	0x7e21f413,
+/* 0x0a39: i2c_start_out */
+/* 0x0a3b: i2c_stop */
+	0xf000f87e,
+	0x21f50037,
+	0x37f00946,
+	0x6821f500,
+	0xe8e7f109,
+	0x7e21f403,
 	0xf50137f0,
-	0xf1077e21,
+	0xf1094621,
 	0xf41388e7,
-	0x00f87e21,
-/* 0x0884: i2c_bitw */
-	0x077e21f5,
-	0x03e8e7f1,
-	0xbb7e21f4,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x07d021f5,
-	0xf40464b6,
-	0xe7f11811,
-	0x21f41388,
-	0x0037f07e,
-	0x075c21f5,
-	0x1388e7f1,
-/* 0x08c3: i2c_bitw_out */
-	0xf87e21f4,
-/* 0x08c5: i2c_bitr */
-	0x0137f000,
-	0x077e21f5,
-	0x03e8e7f1,
-	0xbb7e21f4,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x07d021f5,
-	0xf40464b6,
-	0x21f51b11,
-	0x37f007b8,
-	0x5c21f500,
-	0x88e7f107,
+	0x37f07e21,
+	0x6821f501,
+	0x88e7f109,
 	0x7e21f413,
-	0xf4013cf0,
-/* 0x090a: i2c_bitr_done */
-	0x00f80131,
-/* 0x090c: i2c_get_byte */
-	0xf00057f0,
-/* 0x0912: i2c_get_byte_next */
-	0x54b60847,
-	0x0076bb01,
+/* 0x0a6e: i2c_bitw */
+	0x21f500f8,
+	0xe7f10968,
+	0x21f403e8,
+	0x0076bb7e,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b608c5,
-	0x2b11f404,
-	0xb60553fd,
-	0x1bf40142,
-	0x0137f0d8,
-	0xb60076bb,
-	0x50f90465,
-	0xbb046594,
-	0x50bd0256,
-	0xfc0475fd,
-	0x8421f550,
-	0x0464b608,
-/* 0x095c: i2c_get_byte_done */
-/* 0x095e: i2c_put_byte */
-	0x47f000f8,
-/* 0x0961: i2c_put_byte_next */
-	0x0142b608,
-	0xbb3854ff,
+	0x64b609ba,
+	0x1811f404,
+	0x1388e7f1,
+	0xf07e21f4,
+	0x21f50037,
+	0xe7f10946,
+	0x21f41388,
+/* 0x0aad: i2c_bitw_out */
+/* 0x0aaf: i2c_bitr */
+	0xf000f87e,
+	0x21f50137,
+	0xe7f10968,
+	0x21f403e8,
+	0x0076bb7e,
+	0xf90465b6,
+	0x04659450,
+	0xbd0256bb,
+	0x0475fd50,
+	0x21f550fc,
+	0x64b609ba,
+	0x1b11f404,
+	0x09a221f5,
+	0xf50037f0,
+	0xf1094621,
+	0xf41388e7,
+	0x3cf07e21,
+	0x0131f401,
+/* 0x0af4: i2c_bitr_done */
+/* 0x0af6: i2c_get_byte */
+	0x57f000f8,
+	0x0847f000,
+/* 0x0afc: i2c_get_byte_next */
+	0xbb0154b6,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x088421f5,
+	0x0aaf21f5,
 	0xf40464b6,
-	0x46b03411,
-	0xd81bf400,
-	0xb60076bb,
-	0x50f90465,
-	0xbb046594,
-	0x50bd0256,
-	0xfc0475fd,
-	0xc521f550,
-	0x0464b608,
-	0xbb0f11f4,
-	0x36b00076,
-	0x061bf401,
-/* 0x09b7: i2c_put_byte_done */
-	0xf80132f4,
-/* 0x09b9: i2c_addr */
-	0x0076bb00,
+	0x53fd2b11,
+	0x0142b605,
+	0xf0d81bf4,
+	0x76bb0137,
+	0x0465b600,
+	0x659450f9,
+	0x0256bb04,
+	0x75fd50bd,
+	0xf550fc04,
+	0xb60a6e21,
+/* 0x0b46: i2c_get_byte_done */
+	0x00f80464,
+/* 0x0b48: i2c_put_byte */
+/* 0x0b4b: i2c_put_byte_next */
+	0xb60847f0,
+	0x54ff0142,
+	0x0076bb38,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b607f5,
-	0x2911f404,
-	0x012ec3e7,
-	0xfd0134b6,
-	0x76bb0553,
+	0x64b60a6e,
+	0x3411f404,
+	0xf40046b0,
+	0x76bbd81b,
 	0x0465b600,
 	0x659450f9,
 	0x0256bb04,
 	0x75fd50bd,
 	0xf550fc04,
-	0xb6095e21,
-/* 0x09fe: i2c_addr_done */
-	0x00f80464,
-/* 0x0a00: i2c_acquire_addr */
-	0xb6f8cec7,
-	0xe0b702e4,
-	0xee980d1c,
-/* 0x0a0f: i2c_acquire */
-	0xf500f800,
-	0xf40a0021,
-	0xd9f00421,
-	0x4021f403,
-/* 0x0a1e: i2c_release */
-	0x21f500f8,
-	0x21f40a00,
-	0x03daf004,
-	0xf84021f4,
-/* 0x0a2d: i2c_recv */
-	0x0132f400,
-	0xb6f8c1c7,
-	0x16b00214,
-	0x3a1ff528,
-	0xf413a001,
-	0x0032980c,
-	0x0ccc13a0,
-	0xf4003198,
-	0xd0f90231,
-	0xd0f9e0f9,
-	0x000067f1,
-	0x100063f1,
-	0xbb016792,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x0a0f21f5,
-	0xfc0464b6,
-	0x00d6b0d0,
-	0x00b31bf5,
-	0xbb0057f0,
+	0xb60aaf21,
+	0x11f40464,
+	0x0076bb0f,
+	0xf40136b0,
+	0x32f4061b,
+/* 0x0ba1: i2c_put_byte_done */
+/* 0x0ba3: i2c_addr */
+	0xbb00f801,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x09b921f5,
-	0xf50464b6,
-	0xc700d011,
-	0x76bbe0c5,
-	0x0465b600,
-	0x659450f9,
-	0x0256bb04,
-	0x75fd50bd,
-	0xf550fc04,
-	0xb6095e21,
-	0x11f50464,
-	0x57f000ad,
+	0x09df21f5,
+	0xf40464b6,
+	0xc3e72911,
+	0x34b6012e,
+	0x0553fd01,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x4821f550,
+	0x0464b60b,
+/* 0x0be8: i2c_addr_done */
+/* 0x0bea: i2c_acquire_addr */
+	0xcec700f8,
+	0x02e4b6f8,
+	0x0d24e0b7,
+	0xf800ee98,
+/* 0x0bf9: i2c_acquire */
+	0xea21f500,
+	0x0421f40b,
+	0xf403d9f0,
+	0x00f84021,
+/* 0x0c08: i2c_release */
+	0x0bea21f5,
+	0xf00421f4,
+	0x21f403da,
+/* 0x0c17: i2c_recv */
+	0xf400f840,
+	0xc1c70132,
+	0x0214b6f8,
+	0xf52816b0,
+	0xa0013a1f,
+	0x980cfc13,
+	0x13a00032,
+	0x31980cd4,
+	0x0231f400,
+	0xe0f9d0f9,
+	0x67f1d0f9,
+	0x63f10000,
+	0x67921000,
 	0x0076bb01,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b609b9,
-	0x8a11f504,
+	0x64b60bf9,
+	0xb0d0fc04,
+	0x1bf500d6,
+	0x57f000b3,
 	0x0076bb00,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b6090c,
-	0x6a11f404,
-	0xbbe05bcb,
+	0x64b60ba3,
+	0xd011f504,
+	0xe0c5c700,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x4821f550,
+	0x0464b60b,
+	0x00ad11f5,
+	0xbb0157f0,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x085121f5,
-	0xb90464b6,
-	0x74bd025b,
-/* 0x0b33: i2c_recv_not_rd08 */
-	0xb0430ef4,
-	0x1bf401d6,
-	0x0057f03d,
-	0x09b921f5,
-	0xc73311f4,
-	0x21f5e0c5,
-	0x11f4095e,
-	0x0057f029,
-	0x09b921f5,
-	0xc71f11f4,
-	0x21f5e0b5,
-	0x11f4095e,
-	0x5121f515,
-	0xc774bd08,
-	0x1bf408c5,
-	0x0232f409,
-/* 0x0b73: i2c_recv_not_wr08 */
-/* 0x0b73: i2c_recv_done */
-	0xc7030ef4,
-	0x21f5f8ce,
-	0xe0fc0a1e,
-	0x12f4d0fc,
-	0x027cb90a,
-	0x033621f5,
-/* 0x0b88: i2c_recv_exit */
-/* 0x0b8a: i2c_init */
-	0x00f800f8,
-/* 0x0b8c: test_recv */
-	0x05d817f1,
+	0x0ba321f5,
+	0xf50464b6,
+	0xbb008a11,
+	0x65b60076,
+	0x9450f904,
+	0x56bb0465,
+	0xfd50bd02,
+	0x50fc0475,
+	0x0af621f5,
+	0xf40464b6,
+	0x5bcb6a11,
+	0x0076bbe0,
+	0xf90465b6,
+	0x04659450,
+	0xbd0256bb,
+	0x0475fd50,
+	0x21f550fc,
+	0x64b60a3b,
+	0x025bb904,
+	0x0ef474bd,
+/* 0x0d1d: i2c_recv_not_rd08 */
+	0x01d6b043,
+	0xf03d1bf4,
+	0x21f50057,
+	0x11f40ba3,
+	0xe0c5c733,
+	0x0b4821f5,
+	0xf02911f4,
+	0x21f50057,
+	0x11f40ba3,
+	0xe0b5c71f,
+	0x0b4821f5,
+	0xf51511f4,
+	0xbd0a3b21,
+	0x08c5c774,
+	0xf4091bf4,
+	0x0ef40232,
+/* 0x0d5d: i2c_recv_not_wr08 */
+/* 0x0d5d: i2c_recv_done */
+	0xf8cec703,
+	0x0c0821f5,
+	0xd0fce0fc,
+	0xb90a12f4,
+	0x21f5027c,
+/* 0x0d72: i2c_recv_exit */
+	0x00f80336,
+/* 0x0d74: i2c_init */
+/* 0x0d76: test_recv */
+	0x17f100f8,
+	0x14b605d8,
+	0x0011cf06,
+	0xf10110b6,
+	0xb605d807,
+	0x01d00604,
+	0xf104bd00,
+	0xf1d900e7,
+	0xf5134fe3,
+	0xf8025621,
+/* 0x0d9d: test_init */
+	0x00e7f100,
+	0x5621f508,
+/* 0x0da7: idle_recv */
+	0xf800f802,
+/* 0x0da9: idle */
+	0x0031f400,
+	0x05d417f1,
 	0xcf0614b6,
 	0x10b60011,
-	0xd807f101,
+	0xd407f101,
 	0x0604b605,
 	0xbd0001d0,
-	0x00e7f104,
-	0x4fe3f1d9,
-	0x5621f513,
-/* 0x0bb3: test_init */
-	0xf100f802,
-	0xf50800e7,
-	0xf8025621,
-/* 0x0bbd: idle_recv */
-/* 0x0bbf: idle */
-	0xf400f800,
-	0x17f10031,
-	0x14b605d4,
-	0x0011cf06,
-	0xf10110b6,
-	0xb605d407,
-	0x01d00604,
-/* 0x0bdb: idle_loop */
-	0xf004bd00,
-	0x32f45817,
-/* 0x0be1: idle_proc */
-/* 0x0be1: idle_proc_exec */
-	0xb910f902,
-	0x21f5021e,
-	0x10fc033f,
-	0xf40911f4,
-	0x0ef40231,
-/* 0x0bf5: idle_proc_next */
-	0x5810b6ef,
-	0xf4061fb8,
-	0x02f4e61b,
-	0x0028f4dd,
-	0x00bb0ef4,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
+/* 0x0dc5: idle_loop */
+	0x5817f004,
+/* 0x0dcb: idle_proc */
+/* 0x0dcb: idle_proc_exec */
+	0xf90232f4,
+	0x021eb910,
+	0x033f21f5,
+	0x11f410fc,
+	0x0231f409,
+/* 0x0ddf: idle_proc_next */
+	0xb6ef0ef4,
+	0x1fb85810,
+	0xe61bf406,
+	0xf4dd02f4,
+	0x0ef40028,
+	0x000000bb,
 	0x00000000,
 	0x00000000,
 	0x00000000,
diff --git a/drm/nouveau/nvkm/subdev/pmu/fuc/gf119.fuc4.h b/drm/nouveau/nvkm/subdev/pmu/fuc/gf119.fuc4.h
index 2d5bdc5..f449429 100644
--- a/drm/nouveau/nvkm/subdev/pmu/fuc/gf119.fuc4.h
+++ b/drm/nouveau/nvkm/subdev/pmu/fuc/gf119.fuc4.h
@@ -68,7 +68,7 @@ uint32_t gf119_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x46524550,
-	0x00000687,
+	0x000007a4,
 	0x00000685,
 	0x00000000,
 	0x00000000,
@@ -90,8 +90,8 @@ uint32_t gf119_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x5f433249,
-	0x00000aa2,
-	0x00000945,
+	0x00000c53,
+	0x00000af6,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -112,8 +112,8 @@ uint32_t gf119_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x54534554,
-	0x00000ac5,
-	0x00000aa4,
+	0x00000c76,
+	0x00000c55,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -134,8 +134,8 @@ uint32_t gf119_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x454c4449,
-	0x00000ad1,
-	0x00000acf,
+	0x00000c82,
+	0x00000c80,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -834,7 +834,15 @@ uint32_t gf119_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 /* 0x0ccc: memx_train_tail */
-/* 0x0ccc: i2c_scl_map */
+/* 0x0ccc: perf_attr_start */
+/* 0x0ccc: perf_polling_period_us */
+	0x000186a0,
+/* 0x0cd0: perf_eng_gr */
+/* 0x0cd1: perf_eng_vid */
+/* 0x0cd2: perf_eng_mc */
+/* 0x0cd3: perf_eng_pcie */
+	0x00000000,
+/* 0x0cd4: i2c_scl_map */
 	0x00000400,
 	0x00000800,
 	0x00001000,
@@ -845,7 +853,7 @@ uint32_t gf119_pmu_data[] = {
 	0x00020000,
 	0x00040000,
 	0x00080000,
-/* 0x0cf4: i2c_sda_map */
+/* 0x0cfc: i2c_sda_map */
 	0x00100000,
 	0x00200000,
 	0x00400000,
@@ -911,8 +919,6 @@ uint32_t gf119_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x00000000,
-	0x00000000,
-	0x00000000,
 };
 
 uint32_t gf119_pmu_code[] = {
@@ -1393,388 +1399,455 @@ uint32_t gf119_pmu_code[] = {
 /* 0x0683: memx_init */
 	0xf800f8d8,
 /* 0x0685: perf_recv */
-/* 0x0687: perf_init */
-	0xf800f800,
-/* 0x0689: i2c_drive_scl */
-	0x0036b000,
-	0xf10e0bf4,
-	0xd007e007,
+	0x48a7f100,
+	0x53a3f14f,
+	0x06eab854,
+	0xb04d1bf4,
+	0x1bf401d6,
+	0xbdb4bd5f,
+	0xd307f1c4,
+	0x0003f00c,
+	0xbd000c18,
+	0x08c4b604,
+	0x0cd207f1,
+	0x180003f0,
+	0x04bd000c,
+	0xf108c4b6,
+	0xf00cd107,
+	0x0c180003,
+	0xb604bd00,
+	0x07f108c4,
+	0x03f00cd0,
+	0x000c1800,
+	0x21f504bd,
+	0x0ef402e5,
+/* 0x06dd: perf_recv_not_host */
+	0xf721f51b,
+	0xcc07f106,
+	0x0003f00c,
+	0xbd000e98,
+	0xeb21f504,
+	0x1721f501,
+/* 0x06f5: perf_recv_exit */
+/* 0x06f7: perf_counter_readout */
+	0xf900f802,
+	0xf920f910,
+	0xf940f930,
+	0x0817f150,
+	0x0011cf05,
+	0x051827f1,
+	0xf10022cf,
+	0xcf052837,
+	0x47f10033,
+	0x44cf0538,
+	0x4857f100,
+	0x0055cf05,
+	0x0000e7f1,
+	0x8000e3f1,
+	0x050807f1,
+	0xbd000ed0,
+	0x1807f104,
+	0x000ed005,
+	0x07f104bd,
+	0x0ed00528,
+	0xf104bd00,
+	0xd0053807,
+	0x04bd000e,
+	0x054807f1,
+	0xbd000ed0,
+	0xff11cc04,
+	0xf12c21ff,
+	0xf00cd007,
+	0x02000003,
+	0xff04bd00,
+	0x07f13c31,
+	0x03f00cd1,
+	0x00030000,
+	0x41ff04bd,
+	0xd207f14c,
+	0x0003f00c,
+	0xbd000400,
+	0x5c51ff04,
+	0x0cd307f1,
+	0x000003f0,
+	0x04bd0005,
+	0x40fc50fc,
+	0x20fc30fc,
+	0x00f810fc,
+/* 0x07a4: perf_init */
+	0x0003e7f1,
+	0xf100e3f0,
+	0xd0050c07,
+	0x04bd000e,
+	0x0002e7f1,
+	0xf100e3f0,
+	0xd0051c07,
+	0x04bd000e,
+	0x052c07f1,
+	0xbd000ed0,
+	0x3c07f104,
+	0x000ed005,
+	0x07f104bd,
+	0x0ed0054c,
+	0xf104bd00,
+	0xf0000fe7,
+	0x07f118e3,
+	0x0ed00514,
+	0xf104bd00,
+	0xf00070e7,
+	0x07f100e3,
+	0x0ed00524,
+	0xf104bd00,
+	0xf00080e7,
+	0x07f100e3,
+	0x0ed00534,
+	0xf104bd00,
+	0xf10000e7,
+	0xf12000e3,
+	0xd0054407,
+	0x04bd000e,
+	0x06f721f5,
+	0x0ccc07f1,
+	0x980003f0,
+	0x04bd000e,
+	0x01eb21f5,
+	0x021721f5,
+/* 0x083a: i2c_drive_scl */
+	0x36b000f8,
+	0x0e0bf400,
+	0x07e007f1,
+	0xbd0001d0,
+/* 0x084b: i2c_drive_scl_lo */
+	0xf100f804,
+	0xd007e407,
 	0x04bd0001,
-/* 0x069a: i2c_drive_scl_lo */
-	0x07f100f8,
-	0x01d007e4,
-	0xf804bd00,
-/* 0x06a5: i2c_drive_sda */
-	0x0036b000,
-	0xf10e0bf4,
-	0xd007e007,
+/* 0x0856: i2c_drive_sda */
+	0x36b000f8,
+	0x0e0bf400,
+	0x07e007f1,
+	0xbd0002d0,
+/* 0x0867: i2c_drive_sda_lo */
+	0xf100f804,
+	0xd007e407,
 	0x04bd0002,
-/* 0x06b6: i2c_drive_sda_lo */
-	0x07f100f8,
-	0x02d007e4,
-	0xf804bd00,
-/* 0x06c1: i2c_sense_scl */
-	0x0132f400,
-	0x07c437f1,
-	0xfd0033cf,
-	0x0bf40431,
-	0x0131f406,
-/* 0x06d4: i2c_sense_scl_done */
-/* 0x06d6: i2c_sense_sda */
+/* 0x0872: i2c_sense_scl */
 	0x32f400f8,
 	0xc437f101,
 	0x0033cf07,
-	0xf40432fd,
+	0xf40431fd,
 	0x31f4060b,
-/* 0x06e9: i2c_sense_sda_done */
-/* 0x06eb: i2c_raise_scl */
-	0xf900f801,
-	0x9847f140,
+/* 0x0885: i2c_sense_scl_done */
+/* 0x0887: i2c_sense_sda */
+	0xf400f801,
+	0x37f10132,
+	0x33cf07c4,
+	0x0432fd00,
+	0xf4060bf4,
+/* 0x089a: i2c_sense_sda_done */
+	0x00f80131,
+/* 0x089c: i2c_raise_scl */
+	0x47f140f9,
+	0x37f00898,
+	0x3a21f501,
+/* 0x08a9: i2c_raise_scl_wait */
+	0xe8e7f108,
+	0x6621f403,
+	0x087221f5,
+	0xb60901f4,
+	0x1bf40142,
+/* 0x08bd: i2c_raise_scl_done */
+	0xf840fcef,
+/* 0x08c1: i2c_start */
+	0x7221f500,
+	0x0d11f408,
+	0x088721f5,
+	0xf40611f4,
+/* 0x08d2: i2c_start_rep */
+	0x37f0300e,
+	0x3a21f500,
 	0x0137f008,
-	0x068921f5,
-/* 0x06f8: i2c_raise_scl_wait */
-	0x03e8e7f1,
-	0xf56621f4,
-	0xf406c121,
-	0x42b60901,
-	0xef1bf401,
-/* 0x070c: i2c_raise_scl_done */
-	0x00f840fc,
-/* 0x0710: i2c_start */
-	0x06c121f5,
-	0xf50d11f4,
-	0xf406d621,
-	0x0ef40611,
-/* 0x0721: i2c_start_rep */
-	0x0037f030,
-	0x068921f5,
+	0x085621f5,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x9c21f550,
+	0x0464b608,
+/* 0x08ff: i2c_start_send */
+	0xf01f11f4,
+	0x21f50037,
+	0xe7f10856,
+	0x21f41388,
+	0x0037f066,
+	0x083a21f5,
+	0x1388e7f1,
+/* 0x091b: i2c_start_out */
+	0xf86621f4,
+/* 0x091d: i2c_stop */
+	0x0037f000,
+	0x083a21f5,
+	0xf50037f0,
+	0xf1085621,
+	0xf403e8e7,
+	0x37f06621,
+	0x3a21f501,
+	0x88e7f108,
+	0x6621f413,
 	0xf50137f0,
-	0xbb06a521,
+	0xf1085621,
+	0xf41388e7,
+	0x00f86621,
+/* 0x0950: i2c_bitw */
+	0x085621f5,
+	0x03e8e7f1,
+	0xbb6621f4,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x06eb21f5,
+	0x089c21f5,
 	0xf40464b6,
-/* 0x074e: i2c_start_send */
-	0x37f01f11,
-	0xa521f500,
-	0x88e7f106,
-	0x6621f413,
-	0xf50037f0,
-	0xf1068921,
-	0xf41388e7,
-/* 0x076a: i2c_start_out */
-	0x00f86621,
-/* 0x076c: i2c_stop */
-	0xf50037f0,
-	0xf0068921,
-	0x21f50037,
-	0xe7f106a5,
-	0x21f403e8,
-	0x0137f066,
-	0x068921f5,
-	0x1388e7f1,
-	0xf06621f4,
-	0x21f50137,
-	0xe7f106a5,
+	0xe7f11811,
 	0x21f41388,
-/* 0x079f: i2c_bitw */
-	0xf500f866,
-	0xf106a521,
-	0xf403e8e7,
-	0x76bb6621,
-	0x0465b600,
-	0x659450f9,
-	0x0256bb04,
-	0x75fd50bd,
-	0xf550fc04,
-	0xb606eb21,
-	0x11f40464,
-	0x88e7f118,
-	0x6621f413,
-	0xf50037f0,
-	0xf1068921,
-	0xf41388e7,
-/* 0x07de: i2c_bitw_out */
-	0x00f86621,
-/* 0x07e0: i2c_bitr */
-	0xf50137f0,
-	0xf106a521,
-	0xf403e8e7,
-	0x76bb6621,
-	0x0465b600,
-	0x659450f9,
-	0x0256bb04,
-	0x75fd50bd,
-	0xf550fc04,
-	0xb606eb21,
-	0x11f40464,
-	0xd621f51b,
-	0x0037f006,
-	0x068921f5,
+	0x0037f066,
+	0x083a21f5,
 	0x1388e7f1,
-	0xf06621f4,
-	0x31f4013c,
-/* 0x0825: i2c_bitr_done */
-/* 0x0827: i2c_get_byte */
-	0xf000f801,
-	0x47f00057,
-/* 0x082d: i2c_get_byte_next */
-	0x0154b608,
-	0xb60076bb,
-	0x50f90465,
-	0xbb046594,
-	0x50bd0256,
-	0xfc0475fd,
-	0xe021f550,
-	0x0464b607,
-	0xfd2b11f4,
-	0x42b60553,
-	0xd81bf401,
-	0xbb0137f0,
+/* 0x098f: i2c_bitw_out */
+	0xf86621f4,
+/* 0x0991: i2c_bitr */
+	0x0137f000,
+	0x085621f5,
+	0x03e8e7f1,
+	0xbb6621f4,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x079f21f5,
-/* 0x0877: i2c_get_byte_done */
-	0xf80464b6,
-/* 0x0879: i2c_put_byte */
-	0x0847f000,
-/* 0x087c: i2c_put_byte_next */
-	0xff0142b6,
-	0x76bb3854,
-	0x0465b600,
-	0x659450f9,
-	0x0256bb04,
-	0x75fd50bd,
-	0xf550fc04,
-	0xb6079f21,
-	0x11f40464,
-	0x0046b034,
-	0xbbd81bf4,
+	0x089c21f5,
+	0xf40464b6,
+	0x21f51b11,
+	0x37f00887,
+	0x3a21f500,
+	0x88e7f108,
+	0x6621f413,
+	0xf4013cf0,
+/* 0x09d6: i2c_bitr_done */
+	0x00f80131,
+/* 0x09d8: i2c_get_byte */
+	0xf00057f0,
+/* 0x09de: i2c_get_byte_next */
+	0x54b60847,
+	0x0076bb01,
+	0xf90465b6,
+	0x04659450,
+	0xbd0256bb,
+	0x0475fd50,
+	0x21f550fc,
+	0x64b60991,
+	0x2b11f404,
+	0xb60553fd,
+	0x1bf40142,
+	0x0137f0d8,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x5021f550,
+	0x0464b609,
+/* 0x0a28: i2c_get_byte_done */
+/* 0x0a2a: i2c_put_byte */
+	0x47f000f8,
+/* 0x0a2d: i2c_put_byte_next */
+	0x0142b608,
+	0xbb3854ff,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x07e021f5,
+	0x095021f5,
 	0xf40464b6,
-	0x76bb0f11,
-	0x0136b000,
-	0xf4061bf4,
-/* 0x08d2: i2c_put_byte_done */
-	0x00f80132,
-/* 0x08d4: i2c_addr */
+	0x46b03411,
+	0xd81bf400,
 	0xb60076bb,
 	0x50f90465,
 	0xbb046594,
 	0x50bd0256,
 	0xfc0475fd,
-	0x1021f550,
-	0x0464b607,
-	0xe72911f4,
-	0xb6012ec3,
-	0x53fd0134,
-	0x0076bb05,
+	0x9121f550,
+	0x0464b609,
+	0xbb0f11f4,
+	0x36b00076,
+	0x061bf401,
+/* 0x0a83: i2c_put_byte_done */
+	0xf80132f4,
+/* 0x0a85: i2c_addr */
+	0x0076bb00,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b60879,
-/* 0x0919: i2c_addr_done */
-/* 0x091b: i2c_acquire_addr */
-	0xc700f804,
-	0xe4b6f8ce,
-	0x14e0b705,
-/* 0x0927: i2c_acquire */
-	0xf500f8d0,
-	0xf4091b21,
-	0xd9f00421,
+	0x64b608c1,
+	0x2911f404,
+	0x012ec3e7,
+	0xfd0134b6,
+	0x76bb0553,
+	0x0465b600,
+	0x659450f9,
+	0x0256bb04,
+	0x75fd50bd,
+	0xf550fc04,
+	0xb60a2a21,
+/* 0x0aca: i2c_addr_done */
+	0x00f80464,
+/* 0x0acc: i2c_acquire_addr */
+	0xb6f8cec7,
+	0xe0b705e4,
+	0x00f8d014,
+/* 0x0ad8: i2c_acquire */
+	0x0acc21f5,
+	0xf00421f4,
+	0x21f403d9,
+/* 0x0ae7: i2c_release */
+	0xf500f834,
+	0xf40acc21,
+	0xdaf00421,
 	0x3421f403,
-/* 0x0936: i2c_release */
-	0x21f500f8,
-	0x21f4091b,
-	0x03daf004,
-	0xf83421f4,
-/* 0x0945: i2c_recv */
-	0x0132f400,
-	0xb6f8c1c7,
-	0x16b00214,
-	0x3a1ff528,
-	0xf413a001,
-	0x0032980c,
-	0x0ccc13a0,
-	0xf4003198,
-	0xd0f90231,
-	0xd0f9e0f9,
-	0x000067f1,
-	0x100063f1,
-	0xbb016792,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x092721f5,
-	0xfc0464b6,
-	0x00d6b0d0,
-	0x00b31bf5,
-	0xbb0057f0,
+/* 0x0af6: i2c_recv */
+	0x32f400f8,
+	0xf8c1c701,
+	0xb00214b6,
+	0x1ff52816,
+	0x13a0013a,
+	0x32980cfc,
+	0xd413a000,
+	0x0031980c,
+	0xf90231f4,
+	0xf9e0f9d0,
+	0x0067f1d0,
+	0x0063f100,
+	0x01679210,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0xd821f550,
+	0x0464b60a,
+	0xd6b0d0fc,
+	0xb31bf500,
+	0x0057f000,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x8521f550,
+	0x0464b60a,
+	0x00d011f5,
+	0xbbe0c5c7,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x08d421f5,
+	0x0a2a21f5,
 	0xf50464b6,
-	0xc700d011,
-	0x76bbe0c5,
+	0xf000ad11,
+	0x76bb0157,
 	0x0465b600,
 	0x659450f9,
 	0x0256bb04,
 	0x75fd50bd,
 	0xf550fc04,
-	0xb6087921,
+	0xb60a8521,
 	0x11f50464,
-	0x57f000ad,
-	0x0076bb01,
-	0xf90465b6,
-	0x04659450,
-	0xbd0256bb,
-	0x0475fd50,
-	0x21f550fc,
-	0x64b608d4,
-	0x8a11f504,
-	0x0076bb00,
-	0xf90465b6,
-	0x04659450,
-	0xbd0256bb,
-	0x0475fd50,
-	0x21f550fc,
-	0x64b60827,
-	0x6a11f404,
-	0xbbe05bcb,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x076c21f5,
-	0xb90464b6,
-	0x74bd025b,
-/* 0x0a4b: i2c_recv_not_rd08 */
-	0xb0430ef4,
-	0x1bf401d6,
-	0x0057f03d,
-	0x08d421f5,
-	0xc73311f4,
-	0x21f5e0c5,
-	0x11f40879,
-	0x0057f029,
-	0x08d421f5,
-	0xc71f11f4,
-	0x21f5e0b5,
-	0x11f40879,
-	0x6c21f515,
-	0xc774bd07,
-	0x1bf408c5,
-	0x0232f409,
-/* 0x0a8b: i2c_recv_not_wr08 */
-/* 0x0a8b: i2c_recv_done */
-	0xc7030ef4,
-	0x21f5f8ce,
-	0xe0fc0936,
-	0x12f4d0fc,
-	0x027cb90a,
-	0x02e521f5,
-/* 0x0aa0: i2c_recv_exit */
-/* 0x0aa2: i2c_init */
-	0x00f800f8,
-/* 0x0aa4: test_recv */
-	0x05d817f1,
-	0xb60011cf,
-	0x07f10110,
-	0x01d005d8,
-	0xf104bd00,
-	0xf1d900e7,
-	0xf5134fe3,
-	0xf8021721,
-/* 0x0ac5: test_init */
-	0x00e7f100,
-	0x1721f508,
-/* 0x0acf: idle_recv */
+	0x76bb008a,
+	0x0465b600,
+	0x659450f9,
+	0x0256bb04,
+	0x75fd50bd,
+	0xf550fc04,
+	0xb609d821,
+	0x11f40464,
+	0xe05bcb6a,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x1d21f550,
+	0x0464b609,
+	0xbd025bb9,
+	0x430ef474,
+/* 0x0bfc: i2c_recv_not_rd08 */
+	0xf401d6b0,
+	0x57f03d1b,
+	0x8521f500,
+	0x3311f40a,
+	0xf5e0c5c7,
+	0xf40a2a21,
+	0x57f02911,
+	0x8521f500,
+	0x1f11f40a,
+	0xf5e0b5c7,
+	0xf40a2a21,
+	0x21f51511,
+	0x74bd091d,
+	0xf408c5c7,
+	0x32f4091b,
+	0x030ef402,
+/* 0x0c3c: i2c_recv_not_wr08 */
+/* 0x0c3c: i2c_recv_done */
+	0xf5f8cec7,
+	0xfc0ae721,
+	0xf4d0fce0,
+	0x7cb90a12,
+	0xe521f502,
+/* 0x0c51: i2c_recv_exit */
+/* 0x0c53: i2c_init */
 	0xf800f802,
-/* 0x0ad1: idle */
-	0x0031f400,
-	0x05d417f1,
-	0xb60011cf,
-	0x07f10110,
-	0x01d005d4,
-/* 0x0ae7: idle_loop */
-	0xf004bd00,
-	0x32f45817,
-/* 0x0aed: idle_proc */
-/* 0x0aed: idle_proc_exec */
-	0xb910f902,
-	0x21f5021e,
-	0x10fc02ee,
-	0xf40911f4,
-	0x0ef40231,
-/* 0x0b01: idle_proc_next */
-	0x5810b6ef,
-	0xf4061fb8,
-	0x02f4e61b,
-	0x0028f4dd,
-	0x00c10ef4,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
+/* 0x0c55: test_recv */
+	0xd817f100,
+	0x0011cf05,
+	0xf10110b6,
+	0xd005d807,
+	0x04bd0001,
+	0xd900e7f1,
+	0x134fe3f1,
+	0x021721f5,
+/* 0x0c76: test_init */
+	0xe7f100f8,
+	0x21f50800,
+	0x00f80217,
+/* 0x0c80: idle_recv */
+/* 0x0c82: idle */
+	0x31f400f8,
+	0xd417f100,
+	0x0011cf05,
+	0xf10110b6,
+	0xd005d407,
+	0x04bd0001,
+/* 0x0c98: idle_loop */
+	0xf45817f0,
+/* 0x0c9e: idle_proc */
+/* 0x0c9e: idle_proc_exec */
+	0x10f90232,
+	0xf5021eb9,
+	0xfc02ee21,
+	0x0911f410,
+	0xf40231f4,
+/* 0x0cb2: idle_proc_next */
+	0x10b6ef0e,
+	0x061fb858,
+	0xf4e61bf4,
+	0x28f4dd02,
+	0xc10ef400,
 	0x00000000,
 	0x00000000,
 	0x00000000,
diff --git a/drm/nouveau/nvkm/subdev/pmu/fuc/gk104.fuc4.h b/drm/nouveau/nvkm/subdev/pmu/fuc/gk104.fuc4.h
index 061a033..2112cca 100644
--- a/drm/nouveau/nvkm/subdev/pmu/fuc/gk104.fuc4.h
+++ b/drm/nouveau/nvkm/subdev/pmu/fuc/gk104.fuc4.h
@@ -68,7 +68,7 @@ uint32_t gk104_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x46524550,
-	0x00000687,
+	0x000007a4,
 	0x00000685,
 	0x00000000,
 	0x00000000,
@@ -90,8 +90,8 @@ uint32_t gk104_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x5f433249,
-	0x00000aa2,
-	0x00000945,
+	0x00000c53,
+	0x00000af6,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -112,8 +112,8 @@ uint32_t gk104_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x54534554,
-	0x00000ac5,
-	0x00000aa4,
+	0x00000c76,
+	0x00000c55,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -134,8 +134,8 @@ uint32_t gk104_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x454c4449,
-	0x00000ad1,
-	0x00000acf,
+	0x00000c82,
+	0x00000c80,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -834,7 +834,15 @@ uint32_t gk104_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 /* 0x0ccc: memx_train_tail */
-/* 0x0ccc: i2c_scl_map */
+/* 0x0ccc: perf_attr_start */
+/* 0x0ccc: perf_polling_period_us */
+	0x000186a0,
+/* 0x0cd0: perf_eng_gr */
+/* 0x0cd1: perf_eng_vid */
+/* 0x0cd2: perf_eng_mc */
+/* 0x0cd3: perf_eng_pcie */
+	0x00000000,
+/* 0x0cd4: i2c_scl_map */
 	0x00000400,
 	0x00000800,
 	0x00001000,
@@ -845,7 +853,7 @@ uint32_t gk104_pmu_data[] = {
 	0x00020000,
 	0x00040000,
 	0x00080000,
-/* 0x0cf4: i2c_sda_map */
+/* 0x0cfc: i2c_sda_map */
 	0x00100000,
 	0x00200000,
 	0x00400000,
@@ -911,8 +919,6 @@ uint32_t gk104_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x00000000,
-	0x00000000,
-	0x00000000,
 };
 
 uint32_t gk104_pmu_code[] = {
@@ -1393,388 +1399,455 @@ uint32_t gk104_pmu_code[] = {
 /* 0x0683: memx_init */
 	0xf800f8d8,
 /* 0x0685: perf_recv */
-/* 0x0687: perf_init */
-	0xf800f800,
-/* 0x0689: i2c_drive_scl */
-	0x0036b000,
-	0xf10e0bf4,
-	0xd007e007,
+	0x48a7f100,
+	0x53a3f14f,
+	0x06eab854,
+	0xb04d1bf4,
+	0x1bf401d6,
+	0xbdb4bd5f,
+	0xd307f1c4,
+	0x0003f00c,
+	0xbd000c18,
+	0x08c4b604,
+	0x0cd207f1,
+	0x180003f0,
+	0x04bd000c,
+	0xf108c4b6,
+	0xf00cd107,
+	0x0c180003,
+	0xb604bd00,
+	0x07f108c4,
+	0x03f00cd0,
+	0x000c1800,
+	0x21f504bd,
+	0x0ef402e5,
+/* 0x06dd: perf_recv_not_host */
+	0xf721f51b,
+	0xcc07f106,
+	0x0003f00c,
+	0xbd000e98,
+	0xeb21f504,
+	0x1721f501,
+/* 0x06f5: perf_recv_exit */
+/* 0x06f7: perf_counter_readout */
+	0xf900f802,
+	0xf920f910,
+	0xf940f930,
+	0x0817f150,
+	0x0011cf05,
+	0x051827f1,
+	0xf10022cf,
+	0xcf052837,
+	0x47f10033,
+	0x44cf0538,
+	0x4857f100,
+	0x0055cf05,
+	0x0000e7f1,
+	0x8000e3f1,
+	0x050807f1,
+	0xbd000ed0,
+	0x1807f104,
+	0x000ed005,
+	0x07f104bd,
+	0x0ed00528,
+	0xf104bd00,
+	0xd0053807,
+	0x04bd000e,
+	0x054807f1,
+	0xbd000ed0,
+	0xff11cc04,
+	0xf12c21ff,
+	0xf00cd007,
+	0x02000003,
+	0xff04bd00,
+	0x07f13c31,
+	0x03f00cd1,
+	0x00030000,
+	0x41ff04bd,
+	0xd207f14c,
+	0x0003f00c,
+	0xbd000400,
+	0x5c51ff04,
+	0x0cd307f1,
+	0x000003f0,
+	0x04bd0005,
+	0x40fc50fc,
+	0x20fc30fc,
+	0x00f810fc,
+/* 0x07a4: perf_init */
+	0x0003e7f1,
+	0xf100e3f0,
+	0xd0050c07,
+	0x04bd000e,
+	0x0002e7f1,
+	0xf100e3f0,
+	0xd0051c07,
+	0x04bd000e,
+	0x052c07f1,
+	0xbd000ed0,
+	0x3c07f104,
+	0x000ed005,
+	0x07f104bd,
+	0x0ed0054c,
+	0xf104bd00,
+	0xf0000fe7,
+	0x07f138e3,
+	0x0ed00514,
+	0xf104bd00,
+	0xf00070e7,
+	0x07f102e3,
+	0x0ed00524,
+	0xf104bd00,
+	0xf00080e7,
+	0x07f100e3,
+	0x0ed00534,
+	0xf104bd00,
+	0xf10000e7,
+	0xf12000e3,
+	0xd0054407,
+	0x04bd000e,
+	0x06f721f5,
+	0x0ccc07f1,
+	0x980003f0,
+	0x04bd000e,
+	0x01eb21f5,
+	0x021721f5,
+/* 0x083a: i2c_drive_scl */
+	0x36b000f8,
+	0x0e0bf400,
+	0x07e007f1,
+	0xbd0001d0,
+/* 0x084b: i2c_drive_scl_lo */
+	0xf100f804,
+	0xd007e407,
 	0x04bd0001,
-/* 0x069a: i2c_drive_scl_lo */
-	0x07f100f8,
-	0x01d007e4,
-	0xf804bd00,
-/* 0x06a5: i2c_drive_sda */
-	0x0036b000,
-	0xf10e0bf4,
-	0xd007e007,
+/* 0x0856: i2c_drive_sda */
+	0x36b000f8,
+	0x0e0bf400,
+	0x07e007f1,
+	0xbd0002d0,
+/* 0x0867: i2c_drive_sda_lo */
+	0xf100f804,
+	0xd007e407,
 	0x04bd0002,
-/* 0x06b6: i2c_drive_sda_lo */
-	0x07f100f8,
-	0x02d007e4,
-	0xf804bd00,
-/* 0x06c1: i2c_sense_scl */
-	0x0132f400,
-	0x07c437f1,
-	0xfd0033cf,
-	0x0bf40431,
-	0x0131f406,
-/* 0x06d4: i2c_sense_scl_done */
-/* 0x06d6: i2c_sense_sda */
+/* 0x0872: i2c_sense_scl */
 	0x32f400f8,
 	0xc437f101,
 	0x0033cf07,
-	0xf40432fd,
+	0xf40431fd,
 	0x31f4060b,
-/* 0x06e9: i2c_sense_sda_done */
-/* 0x06eb: i2c_raise_scl */
-	0xf900f801,
-	0x9847f140,
+/* 0x0885: i2c_sense_scl_done */
+/* 0x0887: i2c_sense_sda */
+	0xf400f801,
+	0x37f10132,
+	0x33cf07c4,
+	0x0432fd00,
+	0xf4060bf4,
+/* 0x089a: i2c_sense_sda_done */
+	0x00f80131,
+/* 0x089c: i2c_raise_scl */
+	0x47f140f9,
+	0x37f00898,
+	0x3a21f501,
+/* 0x08a9: i2c_raise_scl_wait */
+	0xe8e7f108,
+	0x6621f403,
+	0x087221f5,
+	0xb60901f4,
+	0x1bf40142,
+/* 0x08bd: i2c_raise_scl_done */
+	0xf840fcef,
+/* 0x08c1: i2c_start */
+	0x7221f500,
+	0x0d11f408,
+	0x088721f5,
+	0xf40611f4,
+/* 0x08d2: i2c_start_rep */
+	0x37f0300e,
+	0x3a21f500,
 	0x0137f008,
-	0x068921f5,
-/* 0x06f8: i2c_raise_scl_wait */
-	0x03e8e7f1,
-	0xf56621f4,
-	0xf406c121,
-	0x42b60901,
-	0xef1bf401,
-/* 0x070c: i2c_raise_scl_done */
-	0x00f840fc,
-/* 0x0710: i2c_start */
-	0x06c121f5,
-	0xf50d11f4,
-	0xf406d621,
-	0x0ef40611,
-/* 0x0721: i2c_start_rep */
-	0x0037f030,
-	0x068921f5,
+	0x085621f5,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x9c21f550,
+	0x0464b608,
+/* 0x08ff: i2c_start_send */
+	0xf01f11f4,
+	0x21f50037,
+	0xe7f10856,
+	0x21f41388,
+	0x0037f066,
+	0x083a21f5,
+	0x1388e7f1,
+/* 0x091b: i2c_start_out */
+	0xf86621f4,
+/* 0x091d: i2c_stop */
+	0x0037f000,
+	0x083a21f5,
+	0xf50037f0,
+	0xf1085621,
+	0xf403e8e7,
+	0x37f06621,
+	0x3a21f501,
+	0x88e7f108,
+	0x6621f413,
 	0xf50137f0,
-	0xbb06a521,
+	0xf1085621,
+	0xf41388e7,
+	0x00f86621,
+/* 0x0950: i2c_bitw */
+	0x085621f5,
+	0x03e8e7f1,
+	0xbb6621f4,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x06eb21f5,
+	0x089c21f5,
 	0xf40464b6,
-/* 0x074e: i2c_start_send */
-	0x37f01f11,
-	0xa521f500,
-	0x88e7f106,
-	0x6621f413,
-	0xf50037f0,
-	0xf1068921,
-	0xf41388e7,
-/* 0x076a: i2c_start_out */
-	0x00f86621,
-/* 0x076c: i2c_stop */
-	0xf50037f0,
-	0xf0068921,
-	0x21f50037,
-	0xe7f106a5,
-	0x21f403e8,
-	0x0137f066,
-	0x068921f5,
-	0x1388e7f1,
-	0xf06621f4,
-	0x21f50137,
-	0xe7f106a5,
+	0xe7f11811,
 	0x21f41388,
-/* 0x079f: i2c_bitw */
-	0xf500f866,
-	0xf106a521,
-	0xf403e8e7,
-	0x76bb6621,
-	0x0465b600,
-	0x659450f9,
-	0x0256bb04,
-	0x75fd50bd,
-	0xf550fc04,
-	0xb606eb21,
-	0x11f40464,
-	0x88e7f118,
-	0x6621f413,
-	0xf50037f0,
-	0xf1068921,
-	0xf41388e7,
-/* 0x07de: i2c_bitw_out */
-	0x00f86621,
-/* 0x07e0: i2c_bitr */
-	0xf50137f0,
-	0xf106a521,
-	0xf403e8e7,
-	0x76bb6621,
-	0x0465b600,
-	0x659450f9,
-	0x0256bb04,
-	0x75fd50bd,
-	0xf550fc04,
-	0xb606eb21,
-	0x11f40464,
-	0xd621f51b,
-	0x0037f006,
-	0x068921f5,
+	0x0037f066,
+	0x083a21f5,
 	0x1388e7f1,
-	0xf06621f4,
-	0x31f4013c,
-/* 0x0825: i2c_bitr_done */
-/* 0x0827: i2c_get_byte */
-	0xf000f801,
-	0x47f00057,
-/* 0x082d: i2c_get_byte_next */
-	0x0154b608,
-	0xb60076bb,
-	0x50f90465,
-	0xbb046594,
-	0x50bd0256,
-	0xfc0475fd,
-	0xe021f550,
-	0x0464b607,
-	0xfd2b11f4,
-	0x42b60553,
-	0xd81bf401,
-	0xbb0137f0,
+/* 0x098f: i2c_bitw_out */
+	0xf86621f4,
+/* 0x0991: i2c_bitr */
+	0x0137f000,
+	0x085621f5,
+	0x03e8e7f1,
+	0xbb6621f4,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x079f21f5,
-/* 0x0877: i2c_get_byte_done */
-	0xf80464b6,
-/* 0x0879: i2c_put_byte */
-	0x0847f000,
-/* 0x087c: i2c_put_byte_next */
-	0xff0142b6,
-	0x76bb3854,
-	0x0465b600,
-	0x659450f9,
-	0x0256bb04,
-	0x75fd50bd,
-	0xf550fc04,
-	0xb6079f21,
-	0x11f40464,
-	0x0046b034,
-	0xbbd81bf4,
+	0x089c21f5,
+	0xf40464b6,
+	0x21f51b11,
+	0x37f00887,
+	0x3a21f500,
+	0x88e7f108,
+	0x6621f413,
+	0xf4013cf0,
+/* 0x09d6: i2c_bitr_done */
+	0x00f80131,
+/* 0x09d8: i2c_get_byte */
+	0xf00057f0,
+/* 0x09de: i2c_get_byte_next */
+	0x54b60847,
+	0x0076bb01,
+	0xf90465b6,
+	0x04659450,
+	0xbd0256bb,
+	0x0475fd50,
+	0x21f550fc,
+	0x64b60991,
+	0x2b11f404,
+	0xb60553fd,
+	0x1bf40142,
+	0x0137f0d8,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x5021f550,
+	0x0464b609,
+/* 0x0a28: i2c_get_byte_done */
+/* 0x0a2a: i2c_put_byte */
+	0x47f000f8,
+/* 0x0a2d: i2c_put_byte_next */
+	0x0142b608,
+	0xbb3854ff,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x07e021f5,
+	0x095021f5,
 	0xf40464b6,
-	0x76bb0f11,
-	0x0136b000,
-	0xf4061bf4,
-/* 0x08d2: i2c_put_byte_done */
-	0x00f80132,
-/* 0x08d4: i2c_addr */
+	0x46b03411,
+	0xd81bf400,
 	0xb60076bb,
 	0x50f90465,
 	0xbb046594,
 	0x50bd0256,
 	0xfc0475fd,
-	0x1021f550,
-	0x0464b607,
-	0xe72911f4,
-	0xb6012ec3,
-	0x53fd0134,
-	0x0076bb05,
+	0x9121f550,
+	0x0464b609,
+	0xbb0f11f4,
+	0x36b00076,
+	0x061bf401,
+/* 0x0a83: i2c_put_byte_done */
+	0xf80132f4,
+/* 0x0a85: i2c_addr */
+	0x0076bb00,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b60879,
-/* 0x0919: i2c_addr_done */
-/* 0x091b: i2c_acquire_addr */
-	0xc700f804,
-	0xe4b6f8ce,
-	0x14e0b705,
-/* 0x0927: i2c_acquire */
-	0xf500f8d0,
-	0xf4091b21,
-	0xd9f00421,
+	0x64b608c1,
+	0x2911f404,
+	0x012ec3e7,
+	0xfd0134b6,
+	0x76bb0553,
+	0x0465b600,
+	0x659450f9,
+	0x0256bb04,
+	0x75fd50bd,
+	0xf550fc04,
+	0xb60a2a21,
+/* 0x0aca: i2c_addr_done */
+	0x00f80464,
+/* 0x0acc: i2c_acquire_addr */
+	0xb6f8cec7,
+	0xe0b705e4,
+	0x00f8d014,
+/* 0x0ad8: i2c_acquire */
+	0x0acc21f5,
+	0xf00421f4,
+	0x21f403d9,
+/* 0x0ae7: i2c_release */
+	0xf500f834,
+	0xf40acc21,
+	0xdaf00421,
 	0x3421f403,
-/* 0x0936: i2c_release */
-	0x21f500f8,
-	0x21f4091b,
-	0x03daf004,
-	0xf83421f4,
-/* 0x0945: i2c_recv */
-	0x0132f400,
-	0xb6f8c1c7,
-	0x16b00214,
-	0x3a1ff528,
-	0xf413a001,
-	0x0032980c,
-	0x0ccc13a0,
-	0xf4003198,
-	0xd0f90231,
-	0xd0f9e0f9,
-	0x000067f1,
-	0x100063f1,
-	0xbb016792,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x092721f5,
-	0xfc0464b6,
-	0x00d6b0d0,
-	0x00b31bf5,
-	0xbb0057f0,
+/* 0x0af6: i2c_recv */
+	0x32f400f8,
+	0xf8c1c701,
+	0xb00214b6,
+	0x1ff52816,
+	0x13a0013a,
+	0x32980cfc,
+	0xd413a000,
+	0x0031980c,
+	0xf90231f4,
+	0xf9e0f9d0,
+	0x0067f1d0,
+	0x0063f100,
+	0x01679210,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0xd821f550,
+	0x0464b60a,
+	0xd6b0d0fc,
+	0xb31bf500,
+	0x0057f000,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x8521f550,
+	0x0464b60a,
+	0x00d011f5,
+	0xbbe0c5c7,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x08d421f5,
+	0x0a2a21f5,
 	0xf50464b6,
-	0xc700d011,
-	0x76bbe0c5,
+	0xf000ad11,
+	0x76bb0157,
 	0x0465b600,
 	0x659450f9,
 	0x0256bb04,
 	0x75fd50bd,
 	0xf550fc04,
-	0xb6087921,
+	0xb60a8521,
 	0x11f50464,
-	0x57f000ad,
-	0x0076bb01,
-	0xf90465b6,
-	0x04659450,
-	0xbd0256bb,
-	0x0475fd50,
-	0x21f550fc,
-	0x64b608d4,
-	0x8a11f504,
-	0x0076bb00,
-	0xf90465b6,
-	0x04659450,
-	0xbd0256bb,
-	0x0475fd50,
-	0x21f550fc,
-	0x64b60827,
-	0x6a11f404,
-	0xbbe05bcb,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x076c21f5,
-	0xb90464b6,
-	0x74bd025b,
-/* 0x0a4b: i2c_recv_not_rd08 */
-	0xb0430ef4,
-	0x1bf401d6,
-	0x0057f03d,
-	0x08d421f5,
-	0xc73311f4,
-	0x21f5e0c5,
-	0x11f40879,
-	0x0057f029,
-	0x08d421f5,
-	0xc71f11f4,
-	0x21f5e0b5,
-	0x11f40879,
-	0x6c21f515,
-	0xc774bd07,
-	0x1bf408c5,
-	0x0232f409,
-/* 0x0a8b: i2c_recv_not_wr08 */
-/* 0x0a8b: i2c_recv_done */
-	0xc7030ef4,
-	0x21f5f8ce,
-	0xe0fc0936,
-	0x12f4d0fc,
-	0x027cb90a,
-	0x02e521f5,
-/* 0x0aa0: i2c_recv_exit */
-/* 0x0aa2: i2c_init */
-	0x00f800f8,
-/* 0x0aa4: test_recv */
-	0x05d817f1,
-	0xb60011cf,
-	0x07f10110,
-	0x01d005d8,
-	0xf104bd00,
-	0xf1d900e7,
-	0xf5134fe3,
-	0xf8021721,
-/* 0x0ac5: test_init */
-	0x00e7f100,
-	0x1721f508,
-/* 0x0acf: idle_recv */
+	0x76bb008a,
+	0x0465b600,
+	0x659450f9,
+	0x0256bb04,
+	0x75fd50bd,
+	0xf550fc04,
+	0xb609d821,
+	0x11f40464,
+	0xe05bcb6a,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0x1d21f550,
+	0x0464b609,
+	0xbd025bb9,
+	0x430ef474,
+/* 0x0bfc: i2c_recv_not_rd08 */
+	0xf401d6b0,
+	0x57f03d1b,
+	0x8521f500,
+	0x3311f40a,
+	0xf5e0c5c7,
+	0xf40a2a21,
+	0x57f02911,
+	0x8521f500,
+	0x1f11f40a,
+	0xf5e0b5c7,
+	0xf40a2a21,
+	0x21f51511,
+	0x74bd091d,
+	0xf408c5c7,
+	0x32f4091b,
+	0x030ef402,
+/* 0x0c3c: i2c_recv_not_wr08 */
+/* 0x0c3c: i2c_recv_done */
+	0xf5f8cec7,
+	0xfc0ae721,
+	0xf4d0fce0,
+	0x7cb90a12,
+	0xe521f502,
+/* 0x0c51: i2c_recv_exit */
+/* 0x0c53: i2c_init */
 	0xf800f802,
-/* 0x0ad1: idle */
-	0x0031f400,
-	0x05d417f1,
-	0xb60011cf,
-	0x07f10110,
-	0x01d005d4,
-/* 0x0ae7: idle_loop */
-	0xf004bd00,
-	0x32f45817,
-/* 0x0aed: idle_proc */
-/* 0x0aed: idle_proc_exec */
-	0xb910f902,
-	0x21f5021e,
-	0x10fc02ee,
-	0xf40911f4,
-	0x0ef40231,
-/* 0x0b01: idle_proc_next */
-	0x5810b6ef,
-	0xf4061fb8,
-	0x02f4e61b,
-	0x0028f4dd,
-	0x00c10ef4,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
+/* 0x0c55: test_recv */
+	0xd817f100,
+	0x0011cf05,
+	0xf10110b6,
+	0xd005d807,
+	0x04bd0001,
+	0xd900e7f1,
+	0x134fe3f1,
+	0x021721f5,
+/* 0x0c76: test_init */
+	0xe7f100f8,
+	0x21f50800,
+	0x00f80217,
+/* 0x0c80: idle_recv */
+/* 0x0c82: idle */
+	0x31f400f8,
+	0xd417f100,
+	0x0011cf05,
+	0xf10110b6,
+	0xd005d407,
+	0x04bd0001,
+/* 0x0c98: idle_loop */
+	0xf45817f0,
+/* 0x0c9e: idle_proc */
+/* 0x0c9e: idle_proc_exec */
+	0x10f90232,
+	0xf5021eb9,
+	0xfc02ee21,
+	0x0911f410,
+	0xf40231f4,
+/* 0x0cb2: idle_proc_next */
+	0x10b6ef0e,
+	0x061fb858,
+	0xf4e61bf4,
+	0x28f4dd02,
+	0xc10ef400,
 	0x00000000,
 	0x00000000,
 	0x00000000,
diff --git a/drm/nouveau/nvkm/subdev/pmu/fuc/gk208.fuc5.h b/drm/nouveau/nvkm/subdev/pmu/fuc/gk208.fuc5.h
index 3c731ff..1e4533d 100644
--- a/drm/nouveau/nvkm/subdev/pmu/fuc/gk208.fuc5.h
+++ b/drm/nouveau/nvkm/subdev/pmu/fuc/gk208.fuc5.h
@@ -68,7 +68,7 @@ uint32_t gk208_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x46524550,
-	0x000005f7,
+	0x000006db,
 	0x000005f5,
 	0x00000000,
 	0x00000000,
@@ -90,8 +90,8 @@ uint32_t gk208_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x5f433249,
-	0x000009f8,
-	0x000008a2,
+	0x00000b4c,
+	0x000009f6,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -112,8 +112,8 @@ uint32_t gk208_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x54534554,
-	0x00000a16,
-	0x000009fa,
+	0x00000b6a,
+	0x00000b4e,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -134,8 +134,8 @@ uint32_t gk208_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x454c4449,
-	0x00000a21,
-	0x00000a1f,
+	0x00000b75,
+	0x00000b73,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -834,7 +834,15 @@ uint32_t gk208_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 /* 0x0ccc: memx_train_tail */
-/* 0x0ccc: i2c_scl_map */
+/* 0x0ccc: perf_attr_start */
+/* 0x0ccc: perf_polling_period_us */
+	0x000186a0,
+/* 0x0cd0: perf_eng_gr */
+/* 0x0cd1: perf_eng_vid */
+/* 0x0cd2: perf_eng_mc */
+/* 0x0cd3: perf_eng_pcie */
+	0x00000000,
+/* 0x0cd4: i2c_scl_map */
 	0x00000400,
 	0x00000800,
 	0x00001000,
@@ -845,7 +853,7 @@ uint32_t gk208_pmu_data[] = {
 	0x00020000,
 	0x00040000,
 	0x00080000,
-/* 0x0cf4: i2c_sda_map */
+/* 0x0cfc: i2c_sda_map */
 	0x00100000,
 	0x00200000,
 	0x00400000,
@@ -911,8 +919,6 @@ uint32_t gk208_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x00000000,
-	0x00000000,
-	0x00000000,
 };
 
 uint32_t gk208_pmu_code[] = {
@@ -1357,92 +1363,180 @@ uint32_t gk208_pmu_code[] = {
 /* 0x05f3: memx_init */
 	0xf800f8dc,
 /* 0x05f5: perf_recv */
-/* 0x05f7: perf_init */
-	0xf800f800,
-/* 0x05f9: i2c_drive_scl */
+	0x4f48da00,
+	0xeaa65453,
+	0xb03d1bf4,
+	0x1bf401d6,
+	0xbdb4bd4b,
+	0x0cd340c4,
+	0xbd000c18,
+	0x08c4b604,
+	0x180cd240,
+	0x04bd000c,
+	0x4008c4b6,
+	0x0c180cd1,
+	0xb604bd00,
+	0xd04008c4,
+	0x000c180c,
+	0x9f7e04bd,
+	0x0ef40002,
+/* 0x0639: perf_recv_not_host */
+	0x064f7e17,
+	0x0ccc4000,
+	0xbd000e98,
+	0x01bb7e04,
+	0x01de7e00,
+/* 0x064d: perf_recv_exit */
+/* 0x064f: perf_counter_readout */
+	0xf900f800,
+	0xf920f910,
+	0xf940f930,
+	0x05084150,
+	0x420011cf,
+	0x22cf0518,
+	0x05284300,
+	0x440033cf,
+	0x44cf0538,
+	0x05484500,
+	0xde0055cf,
+	0x80000000,
+	0xf6050840,
+	0x04bd000e,
+	0xf6051840,
+	0x04bd000e,
+	0xf6052840,
+	0x04bd000e,
+	0xf6053840,
+	0x04bd000e,
+	0xf6054840,
+	0x04bd000e,
+	0xffff11cc,
+	0xd0402c21,
+	0xbd02200c,
+	0x3c31ff04,
+	0x200cd140,
+	0xff04bd03,
+	0xd2404c41,
+	0xbd04200c,
+	0x5c51ff04,
+	0x200cd340,
+	0xfc04bd05,
+	0xfc40fc50,
+	0xfc20fc30,
+/* 0x06db: perf_init */
+	0x0e00f810,
+	0x050c4003,
+	0xbd000ef6,
+	0x40020e04,
+	0x0ef6051c,
+	0x4004bd00,
+	0x0ef6052c,
+	0x4004bd00,
+	0x0ef6053c,
+	0x4004bd00,
+	0x0ef6054c,
+	0x8e04bd00,
+	0x4038000f,
+	0x0ef60514,
+	0x8e04bd00,
+	0x40020070,
+	0x0ef60524,
+	0x4e04bd00,
+	0x34400080,
+	0x000ef605,
+	0x00de04bd,
+	0x40200000,
+	0x0ef60544,
+	0x7e04bd00,
+	0x4000064f,
+	0x0e980ccc,
+	0xf504bd00,
+	0x7e01bb21,
+	0xf80001de,
+/* 0x074d: i2c_drive_scl */
 	0x0036b000,
 	0x400d0bf4,
 	0x01f607e0,
 	0xf804bd00,
-/* 0x0609: i2c_drive_scl_lo */
+/* 0x075d: i2c_drive_scl_lo */
 	0x07e44000,
 	0xbd0001f6,
-/* 0x0613: i2c_drive_sda */
+/* 0x0767: i2c_drive_sda */
 	0xb000f804,
 	0x0bf40036,
 	0x07e0400d,
 	0xbd0002f6,
-/* 0x0623: i2c_drive_sda_lo */
+/* 0x0777: i2c_drive_sda_lo */
 	0x4000f804,
 	0x02f607e4,
 	0xf804bd00,
-/* 0x062d: i2c_sense_scl */
+/* 0x0781: i2c_sense_scl */
 	0x0132f400,
 	0xcf07c443,
 	0x31fd0033,
 	0x060bf404,
-/* 0x063f: i2c_sense_scl_done */
+/* 0x0793: i2c_sense_scl_done */
 	0xf80131f4,
-/* 0x0641: i2c_sense_sda */
+/* 0x0795: i2c_sense_sda */
 	0x0132f400,
 	0xcf07c443,
 	0x32fd0033,
 	0x060bf404,
-/* 0x0653: i2c_sense_sda_done */
+/* 0x07a7: i2c_sense_sda_done */
 	0xf80131f4,
-/* 0x0655: i2c_raise_scl */
+/* 0x07a9: i2c_raise_scl */
 	0x4440f900,
 	0x01030898,
-	0x0005f97e,
-/* 0x0660: i2c_raise_scl_wait */
+	0x00074d7e,
+/* 0x07b4: i2c_raise_scl_wait */
 	0x7e03e84e,
 	0x7e000058,
-	0xf400062d,
+	0xf4000781,
 	0x42b60901,
 	0xef1bf401,
-/* 0x0674: i2c_raise_scl_done */
+/* 0x07c8: i2c_raise_scl_done */
 	0x00f840fc,
-/* 0x0678: i2c_start */
-	0x00062d7e,
+/* 0x07cc: i2c_start */
+	0x0007817e,
 	0x7e0d11f4,
-	0xf4000641,
+	0xf4000795,
 	0x0ef40611,
-/* 0x0689: i2c_start_rep */
+/* 0x07dd: i2c_start_rep */
 	0x7e00032e,
-	0x030005f9,
-	0x06137e01,
+	0x0300074d,
+	0x07677e01,
 	0x0076bb00,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
-	0x557e50fc,
-	0x64b60006,
+	0xa97e50fc,
+	0x64b60007,
 	0x1d11f404,
-/* 0x06b4: i2c_start_send */
-	0x137e0003,
-	0x884e0006,
+/* 0x0808: i2c_start_send */
+	0x677e0003,
+	0x884e0007,
 	0x00587e13,
 	0x7e000300,
-	0x4e0005f9,
+	0x4e00074d,
 	0x587e1388,
-/* 0x06ce: i2c_start_out */
+/* 0x0822: i2c_start_out */
 	0x00f80000,
-/* 0x06d0: i2c_stop */
-	0xf97e0003,
-	0x00030005,
-	0x0006137e,
+/* 0x0824: i2c_stop */
+	0x4d7e0003,
+	0x00030007,
+	0x0007677e,
 	0x7e03e84e,
 	0x03000058,
-	0x05f97e01,
+	0x074d7e01,
 	0x13884e00,
 	0x0000587e,
-	0x137e0103,
-	0x884e0006,
+	0x677e0103,
+	0x884e0007,
 	0x00587e13,
-/* 0x06ff: i2c_bitw */
+/* 0x0853: i2c_bitw */
 	0x7e00f800,
-	0x4e000613,
+	0x4e000767,
 	0x587e03e8,
 	0x76bb0000,
 	0x0465b600,
@@ -1450,17 +1544,17 @@ uint32_t gk208_pmu_code[] = {
 	0x0256bb04,
 	0x75fd50bd,
 	0x7e50fc04,
-	0xb6000655,
+	0xb60007a9,
 	0x11f40464,
 	0x13884e17,
 	0x0000587e,
-	0xf97e0003,
-	0x884e0005,
+	0x4d7e0003,
+	0x884e0007,
 	0x00587e13,
-/* 0x073d: i2c_bitw_out */
-/* 0x073f: i2c_bitr */
+/* 0x0891: i2c_bitw_out */
+/* 0x0893: i2c_bitr */
 	0x0300f800,
-	0x06137e01,
+	0x07677e01,
 	0x03e84e00,
 	0x0000587e,
 	0xb60076bb,
@@ -1468,26 +1562,26 @@ uint32_t gk208_pmu_code[] = {
 	0xbb046594,
 	0x50bd0256,
 	0xfc0475fd,
-	0x06557e50,
+	0x07a97e50,
 	0x0464b600,
 	0x7e1a11f4,
-	0x03000641,
-	0x05f97e00,
+	0x03000795,
+	0x074d7e00,
 	0x13884e00,
 	0x0000587e,
 	0xf4013cf0,
-/* 0x0782: i2c_bitr_done */
+/* 0x08d6: i2c_bitr_done */
 	0x00f80131,
-/* 0x0784: i2c_get_byte */
+/* 0x08d8: i2c_get_byte */
 	0x08040005,
-/* 0x0788: i2c_get_byte_next */
+/* 0x08dc: i2c_get_byte_next */
 	0xbb0154b6,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x00073f7e,
+	0x0008937e,
 	0xf40464b6,
 	0x53fd2a11,
 	0x0142b605,
@@ -1497,12 +1591,12 @@ uint32_t gk208_pmu_code[] = {
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
-	0xff7e50fc,
-	0x64b60006,
-/* 0x07d1: i2c_get_byte_done */
-/* 0x07d3: i2c_put_byte */
+	0x537e50fc,
+	0x64b60008,
+/* 0x0925: i2c_get_byte_done */
+/* 0x0927: i2c_put_byte */
 	0x0400f804,
-/* 0x07d5: i2c_put_byte_next */
+/* 0x0929: i2c_put_byte_next */
 	0x0142b608,
 	0xbb3854ff,
 	0x65b60076,
@@ -1510,7 +1604,7 @@ uint32_t gk208_pmu_code[] = {
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x0006ff7e,
+	0x0008537e,
 	0xf40464b6,
 	0x46b03411,
 	0xd81bf400,
@@ -1519,21 +1613,21 @@ uint32_t gk208_pmu_code[] = {
 	0xbb046594,
 	0x50bd0256,
 	0xfc0475fd,
-	0x073f7e50,
+	0x08937e50,
 	0x0464b600,
 	0xbb0f11f4,
 	0x36b00076,
 	0x061bf401,
-/* 0x082b: i2c_put_byte_done */
+/* 0x097f: i2c_put_byte_done */
 	0xf80132f4,
-/* 0x082d: i2c_addr */
+/* 0x0981: i2c_addr */
 	0x0076bb00,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
-	0x787e50fc,
-	0x64b60006,
+	0xcc7e50fc,
+	0x64b60007,
 	0x2911f404,
 	0x012ec3e7,
 	0xfd0134b6,
@@ -1543,32 +1637,32 @@ uint32_t gk208_pmu_code[] = {
 	0x0256bb04,
 	0x75fd50bd,
 	0x7e50fc04,
-	0xb60007d3,
-/* 0x0872: i2c_addr_done */
+	0xb6000927,
+/* 0x09c6: i2c_addr_done */
 	0x00f80464,
-/* 0x0874: i2c_acquire_addr */
+/* 0x09c8: i2c_acquire_addr */
 	0xb6f8cec7,
 	0xe0b705e4,
 	0x00f8d014,
-/* 0x0880: i2c_acquire */
-	0x0008747e,
+/* 0x09d4: i2c_acquire */
+	0x0009c87e,
 	0x0000047e,
 	0x7e03d9f0,
 	0xf800002d,
-/* 0x0891: i2c_release */
-	0x08747e00,
+/* 0x09e5: i2c_release */
+	0x09c87e00,
 	0x00047e00,
 	0x03daf000,
 	0x00002d7e,
-/* 0x08a2: i2c_recv */
+/* 0x09f6: i2c_recv */
 	0x32f400f8,
 	0xf8c1c701,
 	0xb00214b6,
 	0x1ff52816,
 	0x13b80134,
-	0x98000cf4,
+	0x98000cfc,
 	0x13b80032,
-	0x98000ccc,
+	0x98000cd4,
 	0x31f40031,
 	0xf9d0f902,
 	0xd6d0f9e0,
@@ -1579,7 +1673,7 @@ uint32_t gk208_pmu_code[] = {
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x0008807e,
+	0x0009d47e,
 	0xfc0464b6,
 	0x00d6b0d0,
 	0x00b01bf5,
@@ -1589,7 +1683,7 @@ uint32_t gk208_pmu_code[] = {
 	0x0256bb04,
 	0x75fd50bd,
 	0x7e50fc04,
-	0xb600082d,
+	0xb6000981,
 	0x11f50464,
 	0xc5c700cc,
 	0x0076bbe0,
@@ -1597,8 +1691,8 @@ uint32_t gk208_pmu_code[] = {
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
-	0xd37e50fc,
-	0x64b60007,
+	0x277e50fc,
+	0x64b60009,
 	0xa911f504,
 	0xbb010500,
 	0x65b60076,
@@ -1606,7 +1700,7 @@ uint32_t gk208_pmu_code[] = {
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x00082d7e,
+	0x0009817e,
 	0xf50464b6,
 	0xbb008711,
 	0x65b60076,
@@ -1614,7 +1708,7 @@ uint32_t gk208_pmu_code[] = {
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x0007847e,
+	0x0008d87e,
 	0xf40464b6,
 	0x5bcb6711,
 	0x0076bbe0,
@@ -1622,37 +1716,37 @@ uint32_t gk208_pmu_code[] = {
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
-	0xd07e50fc,
-	0x64b60006,
+	0x247e50fc,
+	0x64b60008,
 	0xbd5bb204,
 	0x410ef474,
-/* 0x09a4: i2c_recv_not_rd08 */
+/* 0x0af8: i2c_recv_not_rd08 */
 	0xf401d6b0,
 	0x00053b1b,
-	0x00082d7e,
+	0x0009817e,
 	0xc73211f4,
-	0xd37ee0c5,
-	0x11f40007,
+	0x277ee0c5,
+	0x11f40009,
 	0x7e000528,
-	0xf400082d,
+	0xf4000981,
 	0xb5c71f11,
-	0x07d37ee0,
+	0x09277ee0,
 	0x1511f400,
-	0x0006d07e,
+	0x0008247e,
 	0xc5c774bd,
 	0x091bf408,
 	0xf40232f4,
-/* 0x09e2: i2c_recv_not_wr08 */
-/* 0x09e2: i2c_recv_done */
+/* 0x0b36: i2c_recv_not_wr08 */
+/* 0x0b36: i2c_recv_done */
 	0xcec7030e,
-	0x08917ef8,
+	0x09e57ef8,
 	0xfce0fc00,
 	0x0912f4d0,
 	0x9f7e7cb2,
-/* 0x09f6: i2c_recv_exit */
+/* 0x0b4a: i2c_recv_exit */
 	0x00f80002,
-/* 0x09f8: i2c_init */
-/* 0x09fa: test_recv */
+/* 0x0b4c: i2c_init */
+/* 0x0b4e: test_recv */
 	0x584100f8,
 	0x0011cf04,
 	0x400110b6,
@@ -1660,27 +1754,27 @@ uint32_t gk208_pmu_code[] = {
 	0xde04bd00,
 	0x134fd900,
 	0x0001de7e,
-/* 0x0a16: test_init */
+/* 0x0b6a: test_init */
 	0x004e00f8,
 	0x01de7e08,
-/* 0x0a1f: idle_recv */
+/* 0x0b73: idle_recv */
 	0xf800f800,
-/* 0x0a21: idle */
+/* 0x0b75: idle */
 	0x0031f400,
 	0xcf045441,
 	0x10b60011,
 	0x04544001,
 	0xbd0001f6,
-/* 0x0a35: idle_loop */
+/* 0x0b89: idle_loop */
 	0xf4580104,
-/* 0x0a3a: idle_proc */
-/* 0x0a3a: idle_proc_exec */
+/* 0x0b8e: idle_proc */
+/* 0x0b8e: idle_proc_exec */
 	0x10f90232,
 	0xa87e1eb2,
 	0x10fc0002,
 	0xf40911f4,
 	0x0ef40231,
-/* 0x0a4d: idle_proc_next */
+/* 0x0ba1: idle_proc_next */
 	0x5810b6f0,
 	0x1bf41fa6,
 	0xe002f4e8,
@@ -1705,25 +1799,4 @@ uint32_t gk208_pmu_code[] = {
 	0x00000000,
 	0x00000000,
 	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
-	0x00000000,
 };
diff --git a/drm/nouveau/nvkm/subdev/pmu/fuc/gt215.fuc3.h b/drm/nouveau/nvkm/subdev/pmu/fuc/gt215.fuc3.h
index e833418..e6523cc 100644
--- a/drm/nouveau/nvkm/subdev/pmu/fuc/gt215.fuc3.h
+++ b/drm/nouveau/nvkm/subdev/pmu/fuc/gt215.fuc3.h
@@ -68,7 +68,7 @@ uint32_t gt215_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x46524550,
-	0x0000083e,
+	0x00000941,
 	0x0000083c,
 	0x00000000,
 	0x00000000,
@@ -90,8 +90,8 @@ uint32_t gt215_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x5f433249,
-	0x00000c6e,
-	0x00000b11,
+	0x00000e00,
+	0x00000ca3,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -112,8 +112,8 @@ uint32_t gt215_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x54534554,
-	0x00000c97,
-	0x00000c70,
+	0x00000e29,
+	0x00000e02,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -134,8 +134,8 @@ uint32_t gt215_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x454c4449,
-	0x00000ca3,
-	0x00000ca1,
+	0x00000e35,
+	0x00000e33,
 	0x00000000,
 	0x00000000,
 	0x00000000,
@@ -834,7 +834,14 @@ uint32_t gt215_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 /* 0x0ccc: memx_train_tail */
-/* 0x0ccc: i2c_scl_map */
+/* 0x0ccc: perf_attr_start */
+/* 0x0ccc: perf_polling_period_us */
+	0x000186a0,
+/* 0x0cd0: perf_eng_gr */
+/* 0x0cd1: perf_eng_vid */
+/* 0x0cd2: perf_eng_mc */
+	0x00000000,
+/* 0x0cd4: i2c_scl_map */
 	0x00001000,
 	0x00004000,
 	0x00010000,
@@ -845,7 +852,7 @@ uint32_t gt215_pmu_data[] = {
 	0x01000000,
 	0x04000000,
 	0x10000000,
-/* 0x0cf4: i2c_sda_map */
+/* 0x0cfc: i2c_sda_map */
 	0x00002000,
 	0x00008000,
 	0x00020000,
@@ -856,7 +863,7 @@ uint32_t gt215_pmu_data[] = {
 	0x02000000,
 	0x08000000,
 	0x20000000,
-/* 0x0d1c: i2c_ctrl */
+/* 0x0d24: i2c_ctrl */
 	0x0000e138,
 	0x0000e150,
 	0x0000e168,
@@ -912,8 +919,6 @@ uint32_t gt215_pmu_data[] = {
 	0x00000000,
 	0x00000000,
 	0x00000000,
-	0x00000000,
-	0x00000000,
 };
 
 uint32_t gt215_pmu_code[] = {
@@ -1512,352 +1517,483 @@ uint32_t gt215_pmu_code[] = {
 /* 0x083a: memx_init */
 	0x00f800f8,
 /* 0x083c: perf_recv */
-/* 0x083e: perf_init */
-	0x00f800f8,
-/* 0x0840: i2c_drive_scl */
-	0xf40036b0,
-	0x07f1110b,
-	0x04b607e0,
-	0x0001d006,
-	0x00f804bd,
-/* 0x0854: i2c_drive_scl_lo */
-	0x07e407f1,
+	0x4f48a7f1,
+	0x5453a3f1,
+	0xf406eab8,
+	0xd6b03e1b,
+	0x501bf401,
+	0xc4bdb4bd,
+	0x0cd207f1,
+	0x180003f0,
+	0x04bd000c,
+	0xf108c4b6,
+	0xf00cd107,
+	0x0c180003,
+	0xb604bd00,
+	0x07f108c4,
+	0x03f00cd0,
+	0x000c1800,
+	0x21f504bd,
+	0x0ef40336,
+/* 0x0885: perf_recv_not_host */
+	0x9f21f51b,
+	0xcc07f108,
+	0x0003f00c,
+	0xbd000e98,
+	0x2a21f504,
+	0x5621f502,
+/* 0x089d: perf_recv_exit */
+/* 0x089f: perf_counter_readout */
+	0xf900f802,
+	0xf920f910,
+	0xf140f930,
+	0xb6050817,
+	0x11cf0614,
+	0x1827f100,
+	0x0624b605,
+	0xf10022cf,
+	0xb6052837,
+	0x33cf0634,
+	0x3847f100,
+	0x0644b605,
+	0xf10044cf,
+	0xf10000e7,
+	0xf18000e3,
+	0xb6050807,
+	0x0ed00604,
+	0xf104bd00,
+	0xb6051807,
+	0x0ed00604,
+	0xf104bd00,
+	0xb6052807,
+	0x0ed00604,
+	0xf104bd00,
+	0xb6053807,
+	0x0ed00604,
+	0xcc04bd00,
+	0x21ffff11,
+	0xd007f12c,
+	0x0003f00c,
+	0xbd000200,
+	0x3c31ff04,
+	0x0cd107f1,
+	0x000003f0,
+	0x04bd0003,
+	0xf14c41ff,
+	0xf00cd207,
+	0x04000003,
+	0xfc04bd00,
+	0xfc30fc40,
+	0xf810fc20,
+/* 0x0941: perf_init */
+	0x03e7f100,
+	0x00e3f000,
+	0x050c07f1,
 	0xd00604b6,
-	0x04bd0001,
-/* 0x0862: i2c_drive_sda */
+	0x04bd000e,
+	0x0002e7f1,
+	0xf100e3f0,
+	0xb6051c07,
+	0x0ed00604,
+	0xf104bd00,
+	0xb6052c07,
+	0x0ed00604,
+	0xf104bd00,
+	0xb6053c07,
+	0x0ed00604,
+	0xf104bd00,
+	0xf0000de7,
+	0x07f100e3,
+	0x04b60514,
+	0x000ed006,
+	0xe7f104bd,
+	0xe3f00070,
+	0x2407f100,
+	0x0604b605,
+	0xbd000ed0,
+	0x00e7f104,
+	0x00e3f001,
+	0x053407f1,
+	0xd00604b6,
+	0x04bd000e,
+	0x089f21f5,
+	0x0ccc07f1,
+	0x980003f0,
+	0x04bd000e,
+	0x022a21f5,
+	0x025621f5,
+/* 0x09d2: i2c_drive_scl */
 	0x36b000f8,
 	0x110bf400,
 	0x07e007f1,
 	0xd00604b6,
-	0x04bd0002,
-/* 0x0876: i2c_drive_sda_lo */
+	0x04bd0001,
+/* 0x09e6: i2c_drive_scl_lo */
 	0x07f100f8,
 	0x04b607e4,
+	0x0001d006,
+	0x00f804bd,
+/* 0x09f4: i2c_drive_sda */
+	0xf40036b0,
+	0x07f1110b,
+	0x04b607e0,
 	0x0002d006,
 	0x00f804bd,
-/* 0x0884: i2c_sense_scl */
-	0xf10132f4,
-	0xb607c437,
-	0x33cf0634,
-	0x0431fd00,
-	0xf4060bf4,
-/* 0x089a: i2c_sense_scl_done */
-	0x00f80131,
-/* 0x089c: i2c_sense_sda */
-	0xf10132f4,
-	0xb607c437,
-	0x33cf0634,
-	0x0432fd00,
-	0xf4060bf4,
-/* 0x08b2: i2c_sense_sda_done */
-	0x00f80131,
-/* 0x08b4: i2c_raise_scl */
-	0x47f140f9,
-	0x37f00898,
-	0x4021f501,
-/* 0x08c1: i2c_raise_scl_wait */
-	0xe8e7f108,
-	0x7e21f403,
-	0x088421f5,
-	0xb60901f4,
-	0x1bf40142,
-/* 0x08d5: i2c_raise_scl_done */
-	0xf840fcef,
-/* 0x08d9: i2c_start */
-	0x8421f500,
-	0x0d11f408,
-	0x089c21f5,
-	0xf40611f4,
-/* 0x08ea: i2c_start_rep */
-	0x37f0300e,
-	0x4021f500,
-	0x0137f008,
-	0x086221f5,
-	0xb60076bb,
-	0x50f90465,
-	0xbb046594,
-	0x50bd0256,
-	0xfc0475fd,
-	0xb421f550,
-	0x0464b608,
-/* 0x0917: i2c_start_send */
-	0xf01f11f4,
+/* 0x0a08: i2c_drive_sda_lo */
+	0x07e407f1,
+	0xd00604b6,
+	0x04bd0002,
+/* 0x0a16: i2c_sense_scl */
+	0x32f400f8,
+	0xc437f101,
+	0x0634b607,
+	0xfd0033cf,
+	0x0bf40431,
+	0x0131f406,
+/* 0x0a2c: i2c_sense_scl_done */
+/* 0x0a2e: i2c_sense_sda */
+	0x32f400f8,
+	0xc437f101,
+	0x0634b607,
+	0xfd0033cf,
+	0x0bf40432,
+	0x0131f406,
+/* 0x0a44: i2c_sense_sda_done */
+/* 0x0a46: i2c_raise_scl */
+	0x40f900f8,
+	0x089847f1,
+	0xf50137f0,
+/* 0x0a53: i2c_raise_scl_wait */
+	0xf109d221,
+	0xf403e8e7,
+	0x21f57e21,
+	0x01f40a16,
+	0x0142b609,
+/* 0x0a67: i2c_raise_scl_done */
+	0xfcef1bf4,
+/* 0x0a6b: i2c_start */
+	0xf500f840,
+	0xf40a1621,
+	0x21f50d11,
+	0x11f40a2e,
+	0x300ef406,
+/* 0x0a7c: i2c_start_rep */
+	0xf50037f0,
+	0xf009d221,
+	0x21f50137,
+	0x76bb09f4,
+	0x0465b600,
+	0x659450f9,
+	0x0256bb04,
+	0x75fd50bd,
+	0xf550fc04,
+	0xb60a4621,
+	0x11f40464,
+/* 0x0aa9: i2c_start_send */
+	0x0037f01f,
+	0x09f421f5,
+	0x1388e7f1,
+	0xf07e21f4,
 	0x21f50037,
-	0xe7f10862,
+	0xe7f109d2,
 	0x21f41388,
-	0x0037f07e,
-	0x084021f5,
-	0x1388e7f1,
-/* 0x0933: i2c_start_out */
-	0xf87e21f4,
-/* 0x0935: i2c_stop */
-	0x0037f000,
-	0x084021f5,
-	0xf50037f0,
-	0xf1086221,
-	0xf403e8e7,
-	0x37f07e21,
-	0x4021f501,
-	0x88e7f108,
-	0x7e21f413,
+/* 0x0ac5: i2c_start_out */
+/* 0x0ac7: i2c_stop */
+	0xf000f87e,
+	0x21f50037,
+	0x37f009d2,
+	0xf421f500,
+	0xe8e7f109,
+	0x7e21f403,
 	0xf50137f0,
-	0xf1086221,
+	0xf109d221,
 	0xf41388e7,
-	0x00f87e21,
-/* 0x0968: i2c_bitw */
-	0x086221f5,
-	0x03e8e7f1,
-	0xbb7e21f4,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x08b421f5,
-	0xf40464b6,
-	0xe7f11811,
-	0x21f41388,
-	0x0037f07e,
-	0x084021f5,
-	0x1388e7f1,
-/* 0x09a7: i2c_bitw_out */
-	0xf87e21f4,
-/* 0x09a9: i2c_bitr */
-	0x0137f000,
-	0x086221f5,
-	0x03e8e7f1,
-	0xbb7e21f4,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x08b421f5,
-	0xf40464b6,
-	0x21f51b11,
-	0x37f0089c,
-	0x4021f500,
-	0x88e7f108,
+	0x37f07e21,
+	0xf421f501,
+	0x88e7f109,
 	0x7e21f413,
-	0xf4013cf0,
-/* 0x09ee: i2c_bitr_done */
-	0x00f80131,
-/* 0x09f0: i2c_get_byte */
-	0xf00057f0,
-/* 0x09f6: i2c_get_byte_next */
-	0x54b60847,
-	0x0076bb01,
+/* 0x0afa: i2c_bitw */
+	0x21f500f8,
+	0xe7f109f4,
+	0x21f403e8,
+	0x0076bb7e,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b609a9,
-	0x2b11f404,
-	0xb60553fd,
-	0x1bf40142,
-	0x0137f0d8,
-	0xb60076bb,
-	0x50f90465,
-	0xbb046594,
-	0x50bd0256,
-	0xfc0475fd,
-	0x6821f550,
-	0x0464b609,
-/* 0x0a40: i2c_get_byte_done */
-/* 0x0a42: i2c_put_byte */
-	0x47f000f8,
-/* 0x0a45: i2c_put_byte_next */
-	0x0142b608,
-	0xbb3854ff,
+	0x64b60a46,
+	0x1811f404,
+	0x1388e7f1,
+	0xf07e21f4,
+	0x21f50037,
+	0xe7f109d2,
+	0x21f41388,
+/* 0x0b39: i2c_bitw_out */
+/* 0x0b3b: i2c_bitr */
+	0xf000f87e,
+	0x21f50137,
+	0xe7f109f4,
+	0x21f403e8,
+	0x0076bb7e,
+	0xf90465b6,
+	0x04659450,
+	0xbd0256bb,
+	0x0475fd50,
+	0x21f550fc,
+	0x64b60a46,
+	0x1b11f404,
+	0x0a2e21f5,
+	0xf50037f0,
+	0xf109d221,
+	0xf41388e7,
+	0x3cf07e21,
+	0x0131f401,
+/* 0x0b80: i2c_bitr_done */
+/* 0x0b82: i2c_get_byte */
+	0x57f000f8,
+	0x0847f000,
+/* 0x0b88: i2c_get_byte_next */
+	0xbb0154b6,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x096821f5,
+	0x0b3b21f5,
 	0xf40464b6,
-	0x46b03411,
-	0xd81bf400,
-	0xb60076bb,
-	0x50f90465,
-	0xbb046594,
-	0x50bd0256,
-	0xfc0475fd,
-	0xa921f550,
-	0x0464b609,
-	0xbb0f11f4,
-	0x36b00076,
-	0x061bf401,
-/* 0x0a9b: i2c_put_byte_done */
-	0xf80132f4,
-/* 0x0a9d: i2c_addr */
-	0x0076bb00,
+	0x53fd2b11,
+	0x0142b605,
+	0xf0d81bf4,
+	0x76bb0137,
+	0x0465b600,
+	0x659450f9,
+	0x0256bb04,
+	0x75fd50bd,
+	0xf550fc04,
+	0xb60afa21,
+/* 0x0bd2: i2c_get_byte_done */
+	0x00f80464,
+/* 0x0bd4: i2c_put_byte */
+/* 0x0bd7: i2c_put_byte_next */
+	0xb60847f0,
+	0x54ff0142,
+	0x0076bb38,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b608d9,
-	0x2911f404,
-	0x012ec3e7,
-	0xfd0134b6,
-	0x76bb0553,
+	0x64b60afa,
+	0x3411f404,
+	0xf40046b0,
+	0x76bbd81b,
 	0x0465b600,
 	0x659450f9,
 	0x0256bb04,
 	0x75fd50bd,
 	0xf550fc04,
-	0xb60a4221,
-/* 0x0ae2: i2c_addr_done */
-	0x00f80464,
-/* 0x0ae4: i2c_acquire_addr */
-	0xb6f8cec7,
-	0xe0b702e4,
-	0xee980d1c,
-/* 0x0af3: i2c_acquire */
-	0xf500f800,
-	0xf40ae421,
-	0xd9f00421,
-	0x4021f403,
-/* 0x0b02: i2c_release */
-	0x21f500f8,
-	0x21f40ae4,
-	0x03daf004,
-	0xf84021f4,
-/* 0x0b11: i2c_recv */
-	0x0132f400,
-	0xb6f8c1c7,
-	0x16b00214,
-	0x3a1ff528,
-	0xf413a001,
-	0x0032980c,
-	0x0ccc13a0,
-	0xf4003198,
-	0xd0f90231,
-	0xd0f9e0f9,
-	0x000067f1,
-	0x100063f1,
-	0xbb016792,
+	0xb60b3b21,
+	0x11f40464,
+	0x0076bb0f,
+	0xf40136b0,
+	0x32f4061b,
+/* 0x0c2d: i2c_put_byte_done */
+/* 0x0c2f: i2c_addr */
+	0xbb00f801,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x0af321f5,
-	0xfc0464b6,
-	0x00d6b0d0,
-	0x00b31bf5,
-	0xbb0057f0,
-	0x65b60076,
-	0x9450f904,
-	0x56bb0465,
-	0xfd50bd02,
-	0x50fc0475,
-	0x0a9d21f5,
-	0xf50464b6,
-	0xc700d011,
-	0x76bbe0c5,
-	0x0465b600,
-	0x659450f9,
-	0x0256bb04,
-	0x75fd50bd,
-	0xf550fc04,
-	0xb60a4221,
-	0x11f50464,
-	0x57f000ad,
+	0x0a6b21f5,
+	0xf40464b6,
+	0xc3e72911,
+	0x34b6012e,
+	0x0553fd01,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0xd421f550,
+	0x0464b60b,
+/* 0x0c74: i2c_addr_done */
+/* 0x0c76: i2c_acquire_addr */
+	0xcec700f8,
+	0x02e4b6f8,
+	0x0d24e0b7,
+	0xf800ee98,
+/* 0x0c85: i2c_acquire */
+	0x7621f500,
+	0x0421f40c,
+	0xf403d9f0,
+	0x00f84021,
+/* 0x0c94: i2c_release */
+	0x0c7621f5,
+	0xf00421f4,
+	0x21f403da,
+/* 0x0ca3: i2c_recv */
+	0xf400f840,
+	0xc1c70132,
+	0x0214b6f8,
+	0xf52816b0,
+	0xa0013a1f,
+	0x980cfc13,
+	0x13a00032,
+	0x31980cd4,
+	0x0231f400,
+	0xe0f9d0f9,
+	0x67f1d0f9,
+	0x63f10000,
+	0x67921000,
 	0x0076bb01,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b60a9d,
-	0x8a11f504,
+	0x64b60c85,
+	0xb0d0fc04,
+	0x1bf500d6,
+	0x57f000b3,
 	0x0076bb00,
 	0xf90465b6,
 	0x04659450,
 	0xbd0256bb,
 	0x0475fd50,
 	0x21f550fc,
-	0x64b609f0,
-	0x6a11f404,
-	0xbbe05bcb,
+	0x64b60c2f,
+	0xd011f504,
+	0xe0c5c700,
+	0xb60076bb,
+	0x50f90465,
+	0xbb046594,
+	0x50bd0256,
+	0xfc0475fd,
+	0xd421f550,
+	0x0464b60b,
+	0x00ad11f5,
+	0xbb0157f0,
 	0x65b60076,
 	0x9450f904,
 	0x56bb0465,
 	0xfd50bd02,
 	0x50fc0475,
-	0x093521f5,
-	0xb90464b6,
-	0x74bd025b,
-/* 0x0c17: i2c_recv_not_rd08 */
-	0xb0430ef4,
-	0x1bf401d6,
-	0x0057f03d,
-	0x0a9d21f5,
-	0xc73311f4,
-	0x21f5e0c5,
-	0x11f40a42,
-	0x0057f029,
-	0x0a9d21f5,
-	0xc71f11f4,
-	0x21f5e0b5,
-	0x11f40a42,
-	0x3521f515,
-	0xc774bd09,
-	0x1bf408c5,
-	0x0232f409,
-/* 0x0c57: i2c_recv_not_wr08 */
-/* 0x0c57: i2c_recv_done */
-	0xc7030ef4,
-	0x21f5f8ce,
-	0xe0fc0b02,
-	0x12f4d0fc,
-	0x027cb90a,
-	0x033621f5,
-/* 0x0c6c: i2c_recv_exit */
-/* 0x0c6e: i2c_init */
-	0x00f800f8,
-/* 0x0c70: test_recv */
-	0x05d817f1,
+	0x0c2f21f5,
+	0xf50464b6,
+	0xbb008a11,
+	0x65b60076,
+	0x9450f904,
+	0x56bb0465,
+	0xfd50bd02,
+	0x50fc0475,
+	0x0b8221f5,
+	0xf40464b6,
+	0x5bcb6a11,
+	0x0076bbe0,
+	0xf90465b6,
+	0x04659450,
+	0xbd0256bb,
+	0x0475fd50,
+	0x21f550fc,
+	0x64b60ac7,
+	0x025bb904,
+	0x0ef474bd,
+/* 0x0da9: i2c_recv_not_rd08 */
+	0x01d6b043,
+	0xf03d1bf4,
+	0x21f50057,
+	0x11f40c2f,
+	0xe0c5c733,
+	0x0bd421f5,
+	0xf02911f4,
+	0x21f50057,
+	0x11f40c2f,
+	0xe0b5c71f,
+	0x0bd421f5,
+	0xf51511f4,
+	0xbd0ac721,
+	0x08c5c774,
+	0xf4091bf4,
+	0x0ef40232,
+/* 0x0de9: i2c_recv_not_wr08 */
+/* 0x0de9: i2c_recv_done */
+	0xf8cec703,
+	0x0c9421f5,
+	0xd0fce0fc,
+	0xb90a12f4,
+	0x21f5027c,
+/* 0x0dfe: i2c_recv_exit */
+	0x00f80336,
+/* 0x0e00: i2c_init */
+/* 0x0e02: test_recv */
+	0x17f100f8,
+	0x14b605d8,
+	0x0011cf06,
+	0xf10110b6,
+	0xb605d807,
+	0x01d00604,
+	0xf104bd00,
+	0xf1d900e7,
+	0xf5134fe3,
+	0xf8025621,
+/* 0x0e29: test_init */
+	0x00e7f100,
+	0x5621f508,
+/* 0x0e33: idle_recv */
+	0xf800f802,
+/* 0x0e35: idle */
+	0x0031f400,
+	0x05d417f1,
 	0xcf0614b6,
 	0x10b60011,
-	0xd807f101,
+	0xd407f101,
 	0x0604b605,
 	0xbd0001d0,
-	0x00e7f104,
-	0x4fe3f1d9,
-	0x5621f513,
-/* 0x0c97: test_init */
-	0xf100f802,
-	0xf50800e7,
-	0xf8025621,
-/* 0x0ca1: idle_recv */
-/* 0x0ca3: idle */
-	0xf400f800,
-	0x17f10031,
-	0x14b605d4,
-	0x0011cf06,
-	0xf10110b6,
-	0xb605d407,
-	0x01d00604,
-/* 0x0cbf: idle_loop */
-	0xf004bd00,
-	0x32f45817,
-/* 0x0cc5: idle_proc */
-/* 0x0cc5: idle_proc_exec */
-	0xb910f902,
-	0x21f5021e,
-	0x10fc033f,
-	0xf40911f4,
-	0x0ef40231,
-/* 0x0cd9: idle_proc_next */
-	0x5810b6ef,
-	0xf4061fb8,
-	0x02f4e61b,
-	0x0028f4dd,
-	0x00bb0ef4,
+/* 0x0e51: idle_loop */
+	0x5817f004,
+/* 0x0e57: idle_proc */
+/* 0x0e57: idle_proc_exec */
+	0xf90232f4,
+	0x021eb910,
+	0x033f21f5,
+	0x11f410fc,
+	0x0231f409,
+/* 0x0e6b: idle_proc_next */
+	0xb6ef0ef4,
+	0x1fb85810,
+	0xe61bf406,
+	0xf4dd02f4,
+	0x0ef40028,
+	0x000000bb,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
+	0x00000000,
 	0x00000000,
 	0x00000000,
 	0x00000000,
diff --git a/drm/nouveau/nvkm/subdev/pmu/fuc/os.h b/drm/nouveau/nvkm/subdev/pmu/fuc/os.h
index c8b06cb..4489c6e 100644
--- a/drm/nouveau/nvkm/subdev/pmu/fuc/os.h
+++ b/drm/nouveau/nvkm/subdev/pmu/fuc/os.h
@@ -49,4 +49,18 @@
 #define I2C__MSG_DATA0_WR08_REG 0:7
 #define I2C__MSG_DATA1_WR08_VAL 0:7
 
+
+/* PERF: message identifiers */
+
+// OUT: load 0x0 - 0xff
+// - byte 3: PCIe load (GF100+)
+// - byte 2: Memory load
+// - byte 1: Video engines' load
+// - byte 0: GR load
+#define PERF_MSG_LOAD 1
+#define PERF_MSG_LOAD_CORE_IDX 0x0
+#define PERF_MSG_LOAD_VID_IDX  0x1
+#define PERF_MSG_LOAD_MEM_IDX  0x2
+#define PERF_MSG_LOAD_PCIE_IDX 0x3
+
 #endif
diff --git a/drm/nouveau/nvkm/subdev/pmu/fuc/perf.fuc b/drm/nouveau/nvkm/subdev/pmu/fuc/perf.fuc
index 38eadf7..bb48aed 100644
--- a/drm/nouveau/nvkm/subdev/pmu/fuc/perf.fuc
+++ b/drm/nouveau/nvkm/subdev/pmu/fuc/perf.fuc
@@ -30,6 +30,18 @@ process(PROC_PERF, #perf_init, #perf_recv)
  * PERF data segment
  *****************************************************************************/
 #ifdef INCLUDE_DATA
+perf_attr_start:
+// parameters
+perf_polling_period_us: .b32 100000
+
+// engine usage (0x0-0xff)
+perf_eng_gr:   .b8 0
+perf_eng_vid:  .b8 0
+perf_eng_mc:   .b8 0
+#if NVKM_PPWR_CHIPSET >= GF100
+perf_eng_pcie: .b8 0
+#endif
+.align 4
 #endif
 
 /******************************************************************************
@@ -37,6 +49,12 @@ process(PROC_PERF, #perf_init, #perf_recv)
  *****************************************************************************/
 #ifdef INCLUDE_CODE
 
+#define TICK_CNT 0
+#define GR_CNT   1
+#define VID_CNT  2
+#define MC_CNT   3
+#define PCIE_CNT 4
+
 // description
 //
 // $r15 - current (perf)
@@ -46,6 +64,86 @@ process(PROC_PERF, #perf_init, #perf_recv)
 // $r11 - data1
 // $r0  - zero
 perf_recv:
+	imm32($r10, PROC_HOST)
+	cmp b32 $r14 $r10
+	bra ne #perf_recv_not_host
+		cmp b32 $r13 PERF_MSG_LOAD
+		bra ne #perf_recv_exit
+			clear b32 $r11
+			clear b32 $r12
+#if NVKM_PPWR_CHIPSET >= GF100
+			ld(b8, $r12, #perf_eng_pcie)
+			shl b32 $r12 8
+#endif
+			ld(b8, $r12, #perf_eng_mc)
+			shl b32 $r12 8
+			ld(b8, $r12, #perf_eng_vid)
+			shl b32 $r12 8
+			ld(b8, $r12, #perf_eng_gr)
+			call(send)
+			bra #perf_recv_exit
+perf_recv_not_host:
+	call(perf_counter_readout)
+	ld(b32, $r14, #perf_polling_period_us)
+	call(ticks_from_us)
+	call(timer)
+perf_recv_exit:
+	ret
+
+// description
+//
+// $r15 - current (perf)
+// $r0  - zero
+perf_counter_readout:
+	push $r1 // ticks
+	push $r2 // gr
+	push $r3 // video
+	push $r4 // mc
+#if NVKM_PPWR_CHIPSET >= GF100
+	push $r5 // pcie
+#endif
+
+	nv_iord($r1, NV_PPWR_COUNTER_COUNT(TICK_CNT))
+	nv_iord($r2, NV_PPWR_COUNTER_COUNT(GR_CNT))
+	nv_iord($r3, NV_PPWR_COUNTER_COUNT(VID_CNT))
+	nv_iord($r4, NV_PPWR_COUNTER_COUNT(MC_CNT))
+#if NVKM_PPWR_CHIPSET >= GF100
+	nv_iord($r5, NV_PPWR_COUNTER_COUNT(PCIE_CNT))
+#endif
+
+	// reset the counters
+	imm32($r14, NV_PPWR_COUNTER_COUNT_RESET)
+	nv_iowr(NV_PPWR_COUNTER_COUNT(TICK_CNT), $r14)
+	nv_iowr(NV_PPWR_COUNTER_COUNT(GR_CNT), $r14)
+	nv_iowr(NV_PPWR_COUNTER_COUNT(VID_CNT), $r14)
+	nv_iowr(NV_PPWR_COUNTER_COUNT(MC_CNT), $r14)
+#if NVKM_PPWR_CHIPSET >= GF100
+	nv_iowr(NV_PPWR_COUNTER_COUNT(PCIE_CNT), $r14)
+#endif
+
+	div $r1 $r1 0xff
+
+	div $r2 $r2 $r1
+	st(b8, #perf_eng_gr, $r2)
+
+	div $r3 $r3 $r1
+	st(b8, #perf_eng_vid, $r3)
+
+	div $r4 $r4 $r1
+	st(b8, #perf_eng_mc, $r4)
+
+#if NVKM_PPWR_CHIPSET >= GF100
+	div $r5 $r5 $r1
+	st(b8, #perf_eng_pcie, $r5)
+#endif
+
+#if NVKM_PPWR_CHIPSET >= GF100
+	pop $r5
+#endif
+	pop $r4
+	pop $r3
+	pop $r2
+	pop $r1
 	ret
 
 // description
@@ -53,5 +151,69 @@ perf_recv:
 // $r15 - current (perf)
 // $r0  - zero
 perf_init:
+	// set up the total ticks counter first
+	imm32($r14, NV_PPWR_COUNTER_MODE_ALWAYS)
+	nv_iowr(NV_PPWR_COUNTER_MODE(TICK_CNT), $r14)
+
+	// set up the other counters, with fermi there are more
+	imm32($r14, NV_PPWR_COUNTER_MODE_IF_NOT_ALL)
+	nv_iowr(NV_PPWR_COUNTER_MODE(GR_CNT), $r14)
+	nv_iowr(NV_PPWR_COUNTER_MODE(VID_CNT), $r14)
+	nv_iowr(NV_PPWR_COUNTER_MODE(MC_CNT), $r14)
+#if NVKM_PPWR_CHIPSET >= GF100
+	nv_iowr(NV_PPWR_COUNTER_MODE(PCIE_CNT), $r14)
+#endif
+
+	// core load counter
+	imm32($r14,
+		  NV_PPWR_COUNTER_SIG_GR
+		| NV_PPWR_COUNTER_SIG_GR_GPC
+		| NV_PPWR_COUNTER_SIG_GR_ROP
+#if NVKM_PPWR_CHIPSET >= GF100
+		| NV_PPWR_COUNTER_SIG_GR_HUB
+		| NV_PPWR_COUNTER_SIG_PCOPY0
+		| NV_PPWR_COUNTER_SIG_PCOPY1
+#endif
+#if NVKM_PPWR_CHIPSET >= GK104
+		| NV_PPWR_COUNTER_SIG_PCOPY2
+#endif
+	)
+	nv_iowr(NV_PPWR_COUNTER_MASK(GR_CNT), $r14)
+
+	// video load counter
+	imm32($r14,
+		  NV_PPWR_COUNTER_SIG_PVLD
+		| NV_PPWR_COUNTER_SIG_PPDEC
+		| NV_PPWR_COUNTER_SIG_PPPP
+#if NVKM_PPWR_CHIPSET >= GK104
+		| NV_PPWR_COUNTER_SIG_PVENC
+#endif
+	)
+	nv_iowr(NV_PPWR_COUNTER_MASK(VID_CNT), $r14)
+
+	// memory load counter
+	imm32($r14,
+#if NVKM_PPWR_CHIPSET >= GF100
+		  NV_PPWR_COUNTER_SIG_BFB_PART0_REQ
+#else
+		  NV_PPWR_COUNTER_SIG_FB_PART0_REQ
+#endif
+	)
+	nv_iowr(NV_PPWR_COUNTER_MASK(MC_CNT), $r14)
+
+	// pcie load counter
+#if NVKM_PPWR_CHIPSET >= GF100
+	imm32($r14, NV_PPWR_COUNTER_SIG_PCIE)
+	nv_iowr(NV_PPWR_COUNTER_MASK(PCIE_CNT), $r14)
+#endif
+
+	// initial read out
+	call(perf_counter_readout)
+
+	// schedule the next read out
+	ld(b32, $r14, #perf_polling_period_us)
+	call #ticks_from_us
+	call(timer)
+
 	ret
 #endif
-- 
2.9.2

